
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>life_demo</title><meta name="generator" content="MATLAB 8.0"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2014-07-16"><meta name="DC.source" content="life_demo.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img { margin-bottom:0px; } 

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, tt, code { font-size:12px; }
pre { margin:0px 0px 20px; }
pre.error { color:red; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><h2>Contents</h2><div><ul><li><a href="#2">Example of initialization and fitting of the LiFE model</a></li><li><a href="#3">Build the file names for the diffusion data, the anatomical MRI.</a></li><li><a href="#4">(1) Evaluate the Probabilistic CSD-based connectome.</a></li><li><a href="#5">(1.1) Initialize the LiFE model structure, 'fe' in the code below.</a></li><li><a href="#6">(1.2) Fit the model.</a></li><li><a href="#7">(1.3) Extract the RMSE of the model on the fitted data set.</a></li><li><a href="#8">(1.4) Extract the RMSE of the model on the second data set.</a></li><li><a href="#9">(1.5) Extract the Rrmse.</a></li><li><a href="#10">(1.6) Extract the fitted weights for the fascicles.</a></li><li><a href="#11">(1.7) Plot a histogram of the RMSE.</a></li><li><a href="#12">(1.8) Plot a histogram of the RMSE ratio.</a></li><li><a href="#13">(1.9) Plot a histogram of the fitted fascicle weights.</a></li><li><a href="#14">Extract the coordinates of the white-matter voxels</a></li><li><a href="#15">(2) Evaluate the Deterministic tensor-based connectome.</a></li><li><a href="#16">(2.1) Initialize the LiFE model structure, 'fe' in the code below.</a></li><li><a href="#17">(2.2) Fit the model.</a></li><li><a href="#18">(2.3) Extract the RMSE of the model on the fitted data set.</a></li><li><a href="#19">(2.4) Extract the RMSE of the model on the second data set.</a></li><li><a href="#20">(2.5) Extract the Rrmse.</a></li><li><a href="#21">(2.6) Extract the fitted weights for the fascicles.</a></li><li><a href="#22">(2.7) Plot a histogram of the RMSE.</a></li><li><a href="#23">(2.8) Plot a histogram of the RMSE ratio.</a></li><li><a href="#24">(2.9) Plot a histogram of the fitted fascicle weights.</a></li><li><a href="#25">Extract the coordinates of the white-matter voxels.</a></li><li><a href="#26">(3) Compare the quality of fit of Probabilistic and Deterministic connectomes.</a></li><li><a href="#27">(3.1) Find the common coordinates between the two connectomes.</a></li><li><a href="#28">(3.2) Make a scatter plot of the RMSE of the two tractography models</a></li><li><a href="#29">(3.3) Compute the strength-of-evidence (S) and the Earth Movers Distance.</a></li><li><a href="#30">(3.4) Strength of evidence in favor of Probabilistic tractography.</a></li><li><a href="#31">(3.5) RMSE distributions for Probabilistic and Deterministic tractography.</a></li></ul></div><pre class="codeinput"><span class="keyword">function</span> [fh, fe] = life_demo()
</pre><h2>Example of initialization and fitting of the LiFE model<a name="2"></a></h2><p>This demo function illustrates how to:  - A - Set up a LiFE structure, identified as 'fe' (fascicle evaluation) in  the code below. This model contains a prediction of the diffusion  measurements in each white-matter voxel given by the fascicles contained  in a tractogrpahy solution, the connectome. Each fascicles makes a  prediction about the direction of diffusion in the set of voxels where  it travels through. The prediction is generated given the fascicle  orientation and position isndie the voxel. Predictions from multiple  fascicles in in each voxels are combined to generate a global connectome  prediciton for the diffusion signal in large sets of white matter  voxels.  - B - Fit the LiFE model to compute the weights associated to each fascicle  in the connectome. Fascicles in the conenctome contribute differently to  predicting the diffusion signal in each voxel. First of all, fascicles  make predictions about the diffusion only in voxels where they travel.  Secondly, some fascicles have paths that produce better diffusion  predictions than others. We use a least-square method to find the  contribution of each fascicle to the diffusion signal in the white  matter voxels where the fascicles travels. A single weight is assigned  to each fascicle representing the global contribution of the fasicle to  the signal of all the voxels along its path - we call this  fascicle-global. Because multiple fascicles exist in several voxels the  set of fascicles weights and fascicles predicitons represents the  connectome-global prediction of the diffusion signal within the entire  set of white matter voxels. Estimating the fascicle weights allows for  evaluating the quality of the tractography solution. Eliminating  fascicles that do not contribute to predicting the diffusion signal  (they have assigned a zreo-weight). Finaly, the root-mean-squared error  (RMSE) of the model to the diffusion data - the model prediction error -  is used to evaluate the model prediction quality, compare different  tractography models and to perform statistical inference on the on  properties of the connectomes.  - C - Compare two different connectome models. This demo will show how to  compare two different conenctome models by using the diffusion  prediction error (the Root-Mean-Squared Error, RMSE). We report the  example of two conenctomes one generated using Constrained-spherical  deconvolution (CSD) and probabilistic tractography the other using a  tensor model and deterministic tractography  - Note - The example connectomes used for this demo comprise a portion  of the right occiptial lobe of an individual human brain. LiFE utilizes  large-scale methods to solve the foward model. The software allows for  solving connectomes spanning the entire white-matter of idnvidual  brains. The size of the connectome on the test data set is small enought  to allow for testing the code within a few minutes requiring only about  10GB of computer RAM and standard hardaware. This code has been tested  with:</p><pre class="language-matlab">- Ubuntu 12.04.4 LTS (Precise)
- 2.6Ghz i7 <span class="string">Processor</span> <span class="string">and</span> <span class="string">24GB</span> <span class="string">of</span> <span class="string">RAM.</span>
- MatLab Version: 8.0.0.783 (R2012b)
</pre><pre class="language-matlab">- Mac OSX <span class="string">10.9</span>
- 1.8 Ghz <span class="string">i5</span> <span class="string">Processor</span> <span class="string">and</span> <span class="string">8GB</span> <span class="string">of</span> <span class="string">RAM</span>
- MatLab Version: 8.0.0.783 (R2012b)
</pre><p>Copyright (2013-2014), Franco Pestilli, Stanford University, <a href="mailto:pestillifranco@gmail.com">pestillifranco@gmail.com</a>.</p><pre class="codeinput"><span class="comment">% Intialize a local matlab cluster if the parallel toolbox is available.</span>
<span class="comment">% This helps speeding up computations espacially for large conenctomes.</span>
feOpenLocalCluster;
</pre><h2>Build the file names for the diffusion data, the anatomical MRI.<a name="3"></a></h2><pre class="codeinput">dwiFile       = fullfile(lifeDemoDataPath(<span class="string">'diffusion'</span>),<span class="string">'life_demo_scan1_subject1_b2000_150dirs_stanford.nii.gz'</span>);
dwiFileRepeat = fullfile(lifeDemoDataPath(<span class="string">'diffusion'</span>),<span class="string">'life_demo_scan2_subject1_b2000_150dirs_stanford.nii.gz'</span>);
t1File        = fullfile(lifeDemoDataPath(<span class="string">'anatomy'</span>),  <span class="string">'life_demo_anatomy_t1w_stanford.nii.gz'</span>);
</pre><h2>(1) Evaluate the Probabilistic CSD-based connectome.<a name="4"></a></h2><p>We will analyze first the CSD-based probabilistic tractography connectome.</p><pre class="codeinput">prob.tractography = <span class="string">'Probabilistic'</span>;
fgFileName    = fullfile(lifeDemoDataPath(<span class="string">'tractography'</span>), <span class="keyword">...</span>
                <span class="string">'life_demo_mrtrix_csd_lmax10_probabilistic.mat'</span>);

<span class="comment">% The final connectome and data astructure will be saved with this name:</span>
feFileName    = <span class="string">'life_build_model_demo_CSD_PROB'</span>;
</pre><h2>(1.1) Initialize the LiFE model structure, 'fe' in the code below.<a name="5"></a></h2><p>This structure contains the forward model of diffusion based on the tractography solution. It also contains all the information necessary to compute model accuracry, and perform statistical tests. You can type help('feBuildModel') in the MatLab prompt for more information.</p><pre class="codeinput">fe = feConnectomeInit(dwiFile,fgFileName,feFileName,[],dwiFileRepeat,t1File);
</pre><pre class="codeoutput">
[feConnectomeInit]
 loading fiber from file: /home/frk/git/life/data/tractography/life_demo_mrtrix_csd_lmax10_probabilistic.mat

[feConnectomeInit] Computing fibers' tensors... Elapsed time is 7.485387 seconds.
[fefgGet] Computing fibers/nodes pairing in each voxel..
[fefgGet] Computing nodes-to-voxels.. took: 1.284minutes.
[fefgGet] Computing voxels-in-fg.. took: 0.447s.
[fefgGet] Computing nodes-in-voxels.. took: 0.474s.
[fefgGet] fiber/node pairing completed in: 16.121s.

Files loaded: 
  dwi   = /home/frk/git/life/data/diffusion/life_demo_scan1_subject1_b2000_150dirs_stanford.nii.gz 
  bvecs = /home/frk/git/life/data/diffusion/life_demo_scan1_subject1_b2000_150dirs_stanford.bvecs 
  bvals = /home/frk/git/life/data/diffusion/life_demo_scan1_subject1_b2000_150dirs_stanford.bvals


Files loaded: 
  dwi   = /home/frk/git/life/data/diffusion/life_demo_scan2_subject1_b2000_150dirs_stanford.nii.gz 
  bvecs = /home/frk/git/life/data/diffusion/life_demo_scan2_subject1_b2000_150dirs_stanford.bvecs 
  bvals = /home/frk/git/life/data/diffusion/life_demo_scan2_subject1_b2000_150dirs_stanford.bvals

LiFE - Building the connectome model...
LiFE - Predicting diffusion signal in 10694 voxel...
LiFE - Prediction computed in: 81.711s.
LiFE - Allocating the model prediction...process completed in 252.177s.
LiFE - DONE Building the connectome model.
</pre><h2>(1.2) Fit the model.<a name="6"></a></h2><p>Hereafter we fit the forward model of tracrography using a least-squared method. The information generated by fitting the model (fiber weights etc) is then installed in the LiFE structure.</p><pre class="codeinput">fe = feSet(fe,<span class="string">'fit'</span>,feFitModel(feGet(fe,<span class="string">'mfiber'</span>),feGet(fe,<span class="string">'dsigdemeaned'</span>),<span class="string">'bbnnls'</span>));
</pre><pre class="codeoutput">
LiFE: Computing least-square minimization with BBNNLS...
Running: **** SBB-NNLS ****

Iter   	     Obj		  ||pg||_inf		 ||x-x*||
-------------------------------------------------------
0001	 1.307919E+09	6.466619E+07	NaN
0002	 1.243174E+09	3.585529E+07	NaN
0003	 1.208840E+09	2.977730E+07	NaN
0004	 1.159646E+09	2.635689E+07	NaN
0005	 1.147525E+09	2.559348E+07	NaN
0006	 1.136161E+09	1.922265E+07	NaN
0007	 1.130214E+09	1.730660E+07	NaN
0008	 1.110027E+09	1.680250E+07	NaN
0009	 1.089190E+09	1.459978E+07	NaN
0010	 1.078166E+09	1.276464E+07	NaN
0011	 1.038559E+09	5.794384E+07	NaN
0012	 1.034712E+09	2.208430E+07	NaN
0013	 1.033524E+09	9.050799E+06	NaN
0014	 1.026760E+09	8.631986E+06	NaN
0015	 1.022509E+09	2.021612E+07	NaN
0016	 1.021654E+09	8.199957E+06	NaN
0017	 1.021025E+09	8.145108E+06	NaN
0018	 1.014731E+09	8.096567E+06	NaN
0019	 1.001784E+09	3.661682E+07	NaN
0020	 1.000342E+09	1.494266E+07	NaN
0021	 9.998125E+08	7.208974E+06	NaN
0022	 9.980974E+08	5.713491E+06	NaN
0023	 9.951437E+08	2.003736E+07	NaN
0024	 9.947451E+08	7.085062E+06	NaN
0025	 9.944719E+08	5.389950E+06	NaN
0026	 9.924290E+08	5.367824E+06	NaN
0027	 9.861289E+08	3.046906E+07	NaN
0028	 9.856522E+08	5.297671E+06	NaN
0029	 9.852687E+08	4.530251E+06	NaN
0030	 9.833146E+08	4.267369E+06	NaN
0031	 9.824782E+08	5.532911E+06	NaN
0032	 9.820785E+08	4.150418E+06	NaN
0033	 9.818460E+08	4.125086E+06	NaN
0034	 9.751396E+08	4.110650E+06	NaN
0035	 9.738408E+08	9.077890E+06	NaN
0036	 9.733680E+08	1.010801E+07	NaN
0037	 9.732383E+08	5.176729E+06	NaN
0038	 9.762260E+08	3.365940E+06	NaN
0039	 9.716284E+08	2.547585E+07	NaN
0040	 9.712928E+08	3.882891E+06	NaN
0041	 9.710759E+08	3.203070E+06	NaN
0042	 9.688401E+08	3.183377E+06	NaN
0043	 9.685904E+08	3.286071E+06	NaN
0044	 9.681592E+08	2.890947E+06	NaN
0045	 9.678729E+08	2.845161E+06	NaN
0046	 9.621745E+08	2.811581E+06	NaN
0047	 9.619519E+08	6.238817E+06	NaN
0048	 9.616957E+08	4.309485E+06	NaN
0049	 9.614659E+08	3.305908E+06	NaN
0050	 9.610926E+08	2.187766E+06	NaN
0051	 9.609719E+08	2.247655E+06	NaN
0052	 9.608367E+08	1.570873E+06	NaN
0053	 9.607682E+08	2.947223E+06	NaN
0054	 9.606375E+08	1.546544E+06	NaN
0055	 9.604227E+08	1.528272E+06	NaN
0056	 9.599080E+08	1.494245E+06	NaN
0057	 9.587330E+08	1.646919E+07	NaN
0058	 9.585722E+08	5.737623E+06	NaN
0059	 9.584041E+08	4.269265E+06	NaN
0060	 9.581604E+08	3.585277E+06	NaN
0061	 9.581161E+08	2.719826E+06	NaN
0062	 9.580108E+08	1.869510E+06	NaN
0063	 9.578532E+08	6.050375E+06	NaN
0064	 9.578310E+08	1.017997E+06	NaN
0065	 9.577823E+08	1.000609E+06	NaN
0066	 9.581825E+08	9.954103E+05	NaN
0067	 9.569259E+08	1.297705E+07	NaN
0068	 9.568947E+08	1.442907E+06	NaN
0069	 9.568679E+08	8.345098E+05	NaN
0070	 9.566514E+08	8.319305E+05	NaN
0071	 9.565919E+08	1.337015E+06	NaN
0072	 9.565595E+08	1.573419E+06	NaN
0073	 9.565445E+08	1.751876E+06	NaN
0074	 9.565027E+08	7.864680E+05	NaN
0075	 9.564852E+08	7.736305E+05	NaN
0076	 9.563229E+08	7.693740E+05	NaN
0077	 9.562957E+08	9.822361E+05	NaN
0078	 9.562757E+08	7.192193E+05	NaN
0079	 9.562642E+08	7.456113E+05	NaN
0080	 9.561133E+08	7.132708E+05	NaN
0081	 9.559795E+08	6.868294E+05	NaN
0082	 9.559649E+08	1.640678E+06	NaN
0083	 9.559481E+08	2.281374E+06	NaN
0084	 9.559365E+08	6.602509E+05	NaN
0085	 9.559111E+08	6.584714E+05	NaN
0086	 9.555176E+08	6.541630E+05	NaN
0087	 9.554840E+08	2.813920E+06	NaN
0088	 9.554702E+08	1.397569E+06	NaN
0089	 9.554617E+08	8.706297E+05	NaN
0090	 9.554427E+08	7.468705E+05	NaN
0091	 9.554346E+08	1.080038E+06	NaN
0092	 9.554243E+08	5.554830E+05	NaN
0093	 9.554168E+08	5.540269E+05	NaN
0094	 9.552601E+08	5.528034E+05	NaN
0095	 9.551597E+08	7.162011E+06	NaN
0096	 9.550484E+08	5.574062E+06	NaN
0097	 9.550170E+08	2.698472E+06	NaN
0098	 9.549932E+08	2.046041E+06	NaN
0099	 9.549425E+08	3.935851E+06	NaN
0100	 9.549352E+08	9.693511E+05	NaN
0101	 9.549180E+08	7.555887E+05	NaN
0102	 9.549135E+08	1.132098E+06	NaN
0103	 9.549051E+08	1.309758E+06	NaN
0104	 9.549017E+08	8.724605E+05	NaN
0105	 9.548994E+08	5.028473E+05	NaN
0106	 9.548813E+08	3.670043E+05	NaN
0107	 9.548767E+08	6.950118E+05	NaN
0108	 9.548742E+08	3.513850E+05	NaN
0109	 9.548726E+08	3.507428E+05	NaN
0110	 9.548454E+08	3.502866E+05	NaN
0111	 9.548374E+08	3.419514E+05	NaN
0112	 9.548408E+08	6.298030E+05	NaN
0113	 9.548303E+08	1.510022E+06	NaN
0114	 9.548289E+08	3.408966E+05	NaN
0115	 9.548276E+08	3.407968E+05	NaN
0116	 9.546962E+08	3.406900E+05	NaN
0117	 9.546949E+08	1.429241E+06	NaN
0118	 9.546762E+08	2.082258E+06	NaN
0119	 9.546719E+08	1.556399E+06	NaN
0120	 9.547269E+08	6.367345E+05	NaN
0121	 9.546592E+08	3.418512E+06	NaN
0122	 9.546578E+08	3.931653E+05	NaN
0123	 9.546571E+08	2.908184E+05	NaN
0124	 9.546511E+08	2.898981E+05	NaN
0125	 9.546498E+08	2.778183E+05	NaN
0126	 9.546490E+08	2.746041E+05	NaN
0127	 9.546479E+08	4.036817E+05	NaN
0128	 9.546475E+08	2.718412E+05	NaN
0129	 9.546472E+08	2.710389E+05	NaN
0130	 9.546379E+08	2.703810E+05	NaN
0131	 9.546460E+08	2.439140E+05	NaN
0132	 9.546395E+08	1.069551E+06	NaN
0133	 9.546358E+08	1.310282E+06	NaN
0134	 9.546352E+08	3.379388E+05	NaN
0135	 9.546348E+08	2.493176E+05	NaN
0136	 9.546339E+08	2.398863E+05	NaN
0137	 9.546336E+08	2.385984E+05	NaN
0138	 9.546328E+08	2.381703E+05	NaN
0139	 9.546325E+08	2.367563E+05	NaN
0140	 9.546323E+08	2.365111E+05	NaN
0141	 9.546321E+08	2.361259E+05	NaN
0142	 9.546165E+08	2.358208E+05	NaN
0143	 9.546290E+08	3.875890E+05	NaN
0144	 9.546184E+08	1.308339E+06	NaN
0145	 9.546164E+08	1.231213E+06	NaN
0146	 9.546195E+08	5.045904E+05	NaN
0147	 9.546144E+08	8.165524E+05	NaN
0148	 9.546143E+08	1.672280E+05	NaN
0149	 9.546141E+08	1.667108E+05	NaN
0150	 9.546131E+08	1.659329E+05	NaN
0151	 9.546129E+08	1.571441E+05	NaN
0152	 9.546128E+08	1.571470E+05	NaN
0153	 9.546127E+08	1.570977E+05	NaN
0154	 9.546126E+08	1.570645E+05	NaN
0155	 9.546123E+08	1.570141E+05	NaN
0156	 9.546061E+08	1.567536E+05	NaN
0157	 9.546026E+08	8.489597E+05	NaN
0158	 9.546021E+08	4.949287E+05	NaN
0159	 9.546018E+08	2.688596E+05	NaN
0160	 9.546014E+08	1.979327E+05	NaN
0161	 9.546011E+08	1.334793E+05	NaN
0162	 9.546021E+08	1.334109E+05	NaN
0163	 9.546007E+08	4.021430E+05	NaN
0164	 9.546006E+08	3.559827E+05	NaN
0165	 9.546005E+08	1.345379E+05	NaN
0166	 9.546004E+08	1.346734E+05	NaN
0167	 9.546003E+08	1.351439E+05	NaN
0168	 9.545999E+08	1.352619E+05	NaN
0169	 9.545998E+08	1.357452E+05	NaN
0170	 9.545998E+08	1.354370E+05	NaN
0171	 9.545998E+08	1.352225E+05	NaN
0172	 9.545997E+08	1.350901E+05	NaN
0173	 9.545997E+08	1.348748E+05	NaN
0174	 9.545995E+08	1.347529E+05	NaN
0175	 9.545995E+08	5.631580E+04	NaN
0176	 9.545999E+08	1.376841E+05	NaN
0177	 9.545994E+08	3.103592E+05	NaN
0178	 9.545994E+08	5.046407E+04	NaN
0179	 9.545993E+08	5.011624E+04	NaN
0180	 9.545988E+08	4.970915E+04	NaN
0181	 9.545990E+08	6.430197E+04	NaN
0182	 9.545988E+08	2.218992E+05	NaN
0183	 9.545987E+08	1.777287E+05	NaN
0184	 9.545987E+08	2.656977E+04	NaN
0185	 9.545987E+08	3.211506E+04	NaN
0186	 9.545986E+08	2.902005E+04	NaN
0187	 9.545986E+08	3.746485E+04	NaN
0188	 9.545986E+08	2.628201E+04	NaN
0189	 9.545986E+08	2.901109E+04	NaN
0190	 9.545986E+08	2.095785E+04	NaN
0191	 9.545986E+08	2.105676E+04	NaN
0192	 9.545983E+08	2.118995E+04	NaN
0193	 9.545991E+08	5.775175E+04	NaN
0194	 9.545988E+08	3.338675E+05	NaN
0195	 9.545982E+08	4.301783E+05	NaN
0196	 9.545982E+08	9.333379E+04	NaN
0197	 9.545982E+08	4.842186E+04	NaN
0198	 9.545982E+08	4.519557E+04	NaN
0199	 9.545982E+08	2.032413E+04	NaN
0200	 9.545982E+08	1.935068E+04	NaN
0201	 9.545982E+08	4.027467E+04	NaN
0202	 9.545982E+08	1.854535E+04	NaN
0203	 9.545982E+08	1.839091E+04	NaN
0204	 9.545981E+08	1.816951E+04	NaN
0205	 9.545983E+08	1.362520E+04	NaN
0206	 9.545993E+08	1.354090E+05	NaN
0207	 9.545981E+08	4.296387E+05	NaN
0208	 9.545981E+08	4.490354E+04	NaN
0209	 9.545981E+08	3.337387E+04	NaN
0210	 9.545981E+08	1.163514E+04	NaN
0211	 9.545981E+08	1.119015E+04	NaN
0212	 9.545981E+08	1.117541E+04	NaN
0213	 9.545981E+08	1.579154E+04	NaN
0214	 9.545981E+08	1.052934E+04	NaN
0215	 9.545981E+08	9.815416E+03	NaN
0216	 9.545981E+08	9.802053E+03	NaN
0217	 9.545981E+08	9.708098E+03	NaN
0218	 9.545982E+08	9.627825E+03	NaN
0219	 9.545980E+08	1.527659E+05	NaN
0220	 9.545980E+08	4.072822E+04	NaN
0221	 9.545980E+08	1.551937E+04	NaN
0222	 9.545980E+08	1.264387E+04	NaN
0223	 9.545980E+08	8.133739E+03	NaN
0224	 9.545980E+08	8.040870E+03	NaN
0225	 9.545980E+08	1.398536E+04	NaN
0226	 9.545980E+08	7.687137E+03	NaN
0227	 9.545980E+08	7.669275E+03	NaN
0228	 9.545980E+08	7.651869E+03	NaN
0229	 9.545980E+08	6.797797E+03	NaN
0230	 9.545980E+08	1.507691E+04	NaN
0231	 9.545980E+08	1.898700E+04	NaN
0232	 9.545980E+08	6.732596E+03	NaN
0233	 9.545980E+08	6.724634E+03	NaN
0234	 9.545980E+08	6.715680E+03	NaN
0235	 9.545980E+08	6.456739E+03	NaN
0236	 9.545980E+08	8.360835E+03	NaN
0237	 9.545980E+08	6.200446E+03	NaN
0238	 9.545980E+08	6.175853E+03	NaN
0239	 9.545980E+08	6.160624E+03	NaN
0240	 9.545980E+08	6.151449E+03	NaN
0241	 9.545980E+08	6.067609E+03	NaN
0242	 9.545993E+08	5.938555E+03	NaN
0243	 9.545980E+08	4.275343E+05	NaN
0244	 9.545979E+08	7.683421E+04	NaN
0245	 9.545979E+08	4.458984E+04	NaN
0246	 9.545979E+08	1.614237E+04	NaN
0247	 9.545979E+08	4.769551E+03	NaN
0248	 9.545979E+08	4.759988E+03	NaN
0249	 9.545979E+08	4.727397E+03	NaN
0250	 9.545979E+08	4.721174E+03	NaN
0251	 9.545979E+08	4.711882E+03	NaN
0252	 9.545979E+08	4.705681E+03	NaN
0253	 9.545979E+08	5.031547E+03	NaN
0254	 9.545979E+08	2.269446E+04	NaN
0255	 9.545979E+08	2.620483E+04	NaN
0256	 9.545979E+08	4.062001E+03	NaN
0257	 9.545979E+08	4.055927E+03	NaN
0258	 9.545979E+08	4.042350E+03	NaN
0259	 9.545979E+08	7.148178E+03	NaN
0260	 9.545979E+08	1.319935E+04	NaN
0261	 9.545979E+08	1.061988E+04	NaN
0262	 9.545979E+08	3.401751E+03	NaN
0263	 9.545979E+08	3.399098E+03	NaN
0264	 9.545979E+08	3.396622E+03	NaN
0265	 9.545979E+08	3.304706E+03	NaN
0266	 9.545979E+08	3.661177E+03	NaN
0267	 9.545979E+08	1.099576E+04	NaN
0268	 9.545979E+08	3.274721E+03	NaN
0269	 9.545979E+08	3.272243E+03	NaN
0270	 9.545979E+08	3.269521E+03	NaN
0271	 9.545979E+08	3.212769E+03	NaN
0272	 9.545979E+08	3.208560E+03	NaN
0273	 9.545979E+08	3.202151E+03	NaN
0274	 9.545979E+08	3.199227E+03	NaN
0275	 9.545979E+08	3.194196E+03	NaN
0276	 9.545979E+08	3.191779E+03	NaN
0277	 9.545979E+08	3.162874E+03	NaN
0278	 9.545979E+08	3.154318E+03	NaN
0279	 9.545979E+08	1.751959E+04	NaN
0280	 9.545979E+08	3.115261E+03	NaN
0281	 9.545979E+08	3.113112E+03	NaN
0282	 9.545979E+08	3.110033E+03	NaN
0283	 9.545979E+08	3.015307E+03	NaN
0284	 9.545979E+08	4.953751E+03	NaN
0285	 9.545979E+08	2.873328E+04	NaN
0286	 9.545979E+08	1.315325E+04	NaN
0287	 9.545979E+08	4.609198E+03	NaN
0288	 9.545979E+08	2.948276E+03	NaN
0289	 9.545979E+08	2.945905E+03	NaN
0290	 9.545979E+08	2.942997E+03	NaN
0291	 9.545979E+08	1.022015E+04	NaN
0292	 9.545979E+08	1.158108E+04	NaN
0293	 9.545979E+08	2.614610E+03	NaN
0294	 9.545979E+08	2.603083E+03	NaN
0295	 9.545979E+08	2.600574E+03	NaN
0296	 9.545979E+08	2.594591E+03	NaN
0297	 9.545979E+08	3.350812E+03	NaN
0298	 9.545979E+08	5.421517E+03	NaN
0299	 9.545979E+08	6.822743E+03	NaN
0300	 9.545979E+08	2.489775E+03	NaN
0301	 9.545979E+08	2.488036E+03	NaN
0302	 9.545979E+08	2.486017E+03	NaN
0303	 9.545979E+08	2.413207E+03	NaN
0304	 9.545979E+08	4.539796E+03	NaN
0305	 9.545979E+08	3.454704E+03	NaN
0306	 9.545979E+08	2.374440E+03	NaN
0307	 9.545979E+08	2.371940E+03	NaN
0308	 9.545979E+08	2.370327E+03	NaN
0309	 9.545979E+08	2.364853E+03	NaN
0310	 9.545979E+08	2.346523E+03	NaN
0311	 9.545979E+08	5.505213E+04	NaN
0312	 9.545979E+08	8.852242E+03	NaN
0313	 9.545979E+08	2.580046E+03	NaN
0314	 9.545979E+08	1.908943E+03	NaN
0315	 9.545979E+08	1.908562E+03	NaN
0316	 9.545979E+08	1.907463E+03	NaN
0317	 9.545979E+08	2.434862E+03	NaN
0318	 9.545979E+08	3.408330E+03	NaN
0319	 9.545979E+08	1.931505E+03	NaN
0320	 9.545979E+08	1.876718E+03	NaN
0321	 9.545979E+08	1.874551E+03	NaN
0322	 9.545979E+08	1.871269E+03	NaN
0323	 9.545979E+08	2.400789E+03	NaN
0324	 9.545979E+08	9.676362E+03	NaN
0325	 9.545979E+08	1.522493E+04	NaN
0326	 9.545979E+08	1.667113E+03	NaN
0327	 9.545979E+08	1.666394E+03	NaN
0328	 9.545979E+08	1.665287E+03	NaN
0329	 9.545979E+08	1.639801E+03	NaN
0330	 9.545979E+08	1.625274E+03	NaN
0331	 9.545979E+08	5.540424E+03	NaN
0332	 9.545979E+08	1.615041E+03	NaN
0333	 9.545979E+08	1.613580E+03	NaN
0334	 9.545979E+08	1.611810E+03	NaN
0335	 9.545979E+08	1.580486E+03	NaN
0336	 9.545979E+08	1.575892E+03	NaN
0337	 9.545979E+08	1.568260E+03	NaN
0338	 9.545979E+08	1.566778E+03	NaN
0339	 9.545979E+08	1.565020E+03	NaN
0340	 9.545979E+08	1.563880E+03	NaN
0341	 9.545979E+08	1.557141E+03	NaN
0342	 9.545979E+08	1.555435E+03	NaN
0343	 9.545979E+08	1.538346E+03	NaN
0344	 9.545979E+08	1.537212E+03	NaN
0345	 9.545979E+08	1.536005E+03	NaN
0346	 9.545979E+08	1.534863E+03	NaN
0347	 9.545979E+08	2.119279E+03	NaN
0348	 9.545979E+08	1.319077E+04	NaN
0349	 9.545979E+08	1.398386E+04	NaN
0350	 9.545979E+08	1.822569E+03	NaN
0351	 9.545979E+08	1.069661E+03	NaN
0352	 9.545979E+08	1.086446E+03	NaN
0353	 9.545979E+08	1.088980E+03	NaN
0354	 9.545979E+08	9.801270E+02	NaN
0355	 9.545979E+08	9.659969E+02	NaN
0356	 9.545979E+08	9.646840E+02	NaN
0357	 9.545979E+08	9.635625E+02	NaN
0358	 9.545979E+08	9.628812E+02	NaN
0359	 9.545979E+08	9.609061E+02	NaN
0360	 9.545979E+08	9.593671E+02	NaN
0361	 9.545979E+08	3.358781E+03	NaN
0362	 9.545979E+08	8.798513E+02	NaN
0363	 9.545979E+08	8.792170E+02	NaN
0364	 9.545979E+08	8.785637E+02	NaN
0365	 9.545979E+08	8.581319E+02	NaN
0366	 9.545979E+08	8.557305E+02	NaN
0367	 9.545979E+08	9.311365E+02	NaN
0368	 9.545979E+08	8.518975E+02	NaN
0369	 9.545979E+08	8.511570E+02	NaN
0370	 9.545979E+08	8.504323E+02	NaN
0371	 9.545979E+08	7.672645E+02	NaN
0372	 9.545979E+08	1.252693E+03	NaN
0373	 9.545979E+08	7.651563E+02	NaN
0374	 9.545979E+08	7.646946E+02	NaN
0375	 9.545979E+08	7.642212E+02	NaN
0376	 9.545979E+08	7.626817E+02	NaN
0377	 9.545979E+08	6.908930E+02	NaN
0378	 9.545979E+08	1.774439E+03	NaN
0379	 9.545979E+08	2.534780E+03	NaN
0380	 9.545979E+08	6.806148E+02	NaN
0381	 9.545979E+08	6.801081E+02	NaN
0382	 9.545979E+08	6.795547E+02	NaN
0383	 9.545979E+08	6.750849E+02	NaN
0384	 9.545979E+08	6.740901E+02	NaN
0385	 9.545979E+08	6.717526E+02	NaN
0386	 9.545979E+08	6.711037E+02	NaN
0387	 9.545979E+08	6.693115E+02	NaN
0388	 9.545979E+08	6.688519E+02	NaN
0389	 9.545979E+08	6.665688E+02	NaN
0390	 9.545979E+08	6.654991E+02	NaN
0391	 9.545979E+08	1.735504E+03	NaN
0392	 9.545979E+08	6.244013E+02	NaN
0393	 9.545979E+08	6.239758E+02	NaN
0394	 9.545979E+08	6.235218E+02	NaN
0395	 9.545979E+08	5.823105E+02	NaN
0396	 9.545979E+08	5.813500E+02	NaN
0397	 9.545979E+08	5.806928E+02	NaN
0398	 9.545979E+08	5.801337E+02	NaN
0399	 9.545979E+08	5.765174E+02	NaN
0400	 9.545979E+08	5.754860E+02	NaN
0401	 9.545979E+08	6.303226E+02	NaN
0402	 9.545979E+08	5.713991E+02	NaN
0403	 9.545979E+08	5.710123E+02	NaN
0404	 9.545979E+08	5.705057E+02	NaN
0405	 9.545979E+08	5.222629E+02	NaN
0406	 9.545979E+08	1.059663E+03	NaN
0407	 9.545979E+08	1.254130E+03	NaN
0408	 9.545979E+08	5.151591E+02	NaN
0409	 9.545979E+08	5.147825E+02	NaN
0410	 9.545979E+08	5.144187E+02	NaN
0411	 9.545979E+08	5.119763E+02	NaN
0412	 9.545979E+08	5.113862E+02	NaN
0413	 9.545979E+08	5.077835E+02	NaN
0414	 9.545979E+08	5.073595E+02	NaN
0415	 9.545979E+08	5.062841E+02	NaN
0416	 9.545979E+08	5.059287E+02	NaN
0417	 9.545979E+08	5.029751E+02	NaN
0418	 9.545979E+08	5.021074E+02	NaN
0419	 9.545979E+08	9.026165E+02	NaN
0420	 9.545979E+08	4.898756E+02	NaN
0421	 9.545979E+08	4.895487E+02	NaN
0422	 9.545979E+08	4.891198E+02	NaN
0423	 9.545979E+08	4.699705E+02	NaN
0424	 9.545979E+08	4.681281E+02	NaN
0425	 9.545979E+08	4.669366E+02	NaN
0426	 9.545979E+08	4.664602E+02	NaN
0427	 9.545979E+08	4.660123E+02	NaN
0428	 9.545979E+08	4.656990E+02	NaN
0429	 9.545979E+08	4.631273E+02	NaN
0430	 9.545979E+08	4.589609E+02	NaN
0431	 9.545979E+08	1.645117E+04	NaN
0432	 9.545979E+08	2.353140E+03	NaN
0433	 9.545979E+08	6.618327E+02	NaN
0434	 9.545979E+08	8.447237E+02	NaN
0435	 9.545979E+08	3.545842E+02	NaN
0436	 9.545979E+08	3.541500E+02	NaN
0437	 9.545979E+08	3.508387E+02	NaN
0438	 9.545979E+08	3.505879E+02	NaN
0439	 9.545979E+08	3.503278E+02	NaN
0440	 9.545979E+08	3.500227E+02	NaN
0441	 9.545979E+08	1.180108E+03	NaN
0442	 9.545979E+08	3.045716E+03	NaN
0443	 9.545979E+08	6.128848E+03	NaN
0444	 9.545979E+08	9.680222E+02	NaN
0445	 9.545979E+08	4.851915E+02	NaN
0446	 9.545979E+08	4.338584E+02	NaN
0447	 9.545979E+08	3.416862E+02	NaN
0448	 9.545979E+08	2.757385E+02	NaN
0449	 9.545979E+08	1.951976E+02	NaN
0450	 9.545979E+08	1.734313E+02	NaN
0451	 9.545979E+08	1.672044E+02	NaN
0452	 9.545979E+08	1.638816E+02	NaN
0453	 9.545979E+08	1.606128E+02	NaN
0454	 9.545979E+08	1.557492E+02	NaN
0455	 9.545979E+08	7.744387E+01	NaN
0456	 9.545979E+08	3.731037E+02	NaN
0457	 9.545979E+08	1.300316E+03	NaN
0458	 9.545979E+08	5.539329E+01	NaN
0459	 9.545979E+08	5.425351E+01	NaN
0460	 9.545979E+08	5.284275E+01	NaN
0461	 9.545979E+08	4.962914E+01	NaN
0462	 9.545979E+08	4.746894E+01	NaN
BBNNLS status: Success
Reason: Relative change in objvalue small enough
 ...fit process completed in 6.864minutes
</pre><h2>(1.3) Extract the RMSE of the model on the fitted data set.<a name="7"></a></h2><p>We now use the LiFE structure and the fit to compute the error in each white-matter voxel spanned by the tractography model.</p><pre class="codeinput">prob.rmse   = feGet(fe,<span class="string">'vox rmse'</span>);
</pre><h2>(1.4) Extract the RMSE of the model on the second data set.<a name="8"></a></h2><p>Here we show how to compute the cross-valdiated RMSE of the tractography model in each white-matter voxel. We store this information for later use and to save computer memory.</p><pre class="codeinput">prob.rmsexv = feGetRep(fe,<span class="string">'vox rmse'</span>);
</pre><h2>(1.5) Extract the Rrmse.<a name="9"></a></h2><p>We show how to extract the ratio between the model prediction error (RMSE) and the test-retest reliability of the data.</p><pre class="codeinput">prob.rrmse  = feGetRep(fe,<span class="string">'vox rmse ratio'</span>);
</pre><h2>(1.6) Extract the fitted weights for the fascicles.<a name="10"></a></h2><p>The following line shows how to extract the weight assigned to each fascicle in the connectome.</p><pre class="codeinput">prob.w      = feGet(fe,<span class="string">'fiber weights'</span>);
</pre><h2>(1.7) Plot a histogram of the RMSE.<a name="11"></a></h2><p>We plot the histogram of  RMSE across white-mater voxels.</p><pre class="codeinput">[fh(1), ~, ~] = plotHistRMSE(prob);
</pre><img vspace="5" hspace="5" src="life_demo_01.png" alt=""> <h2>(1.8) Plot a histogram of the RMSE ratio.<a name="12"></a></h2><p>As a reminder the Rrmse is the ratio between data test-retest reliability and model error (the quality of the model fit).</p><pre class="codeinput">[fh(2), ~] = plotHistRrmse(prob);
</pre><img vspace="5" hspace="5" src="life_demo_02.png" alt=""> <h2>(1.9) Plot a histogram of the fitted fascicle weights.<a name="13"></a></h2><pre class="codeinput">[fh(3), ~] = plotHistWeights(prob);
fe = feConnectomeInit(dwiFile,fgFileName,feFileName,[],dwiFileRepeat,t1File);
</pre><pre class="codeoutput">
[feConnectomeInit]
 loading fiber from file: /home/frk/git/life/data/tractography/life_demo_mrtrix_csd_lmax10_probabilistic.mat

[feConnectomeInit] Computing fibers' tensors... Elapsed time is 8.579060 seconds.
[fefgGet] Computing fibers/nodes pairing in each voxel..
[fefgGet] Computing nodes-to-voxels.. took: 1.310minutes.
[fefgGet] Computing voxels-in-fg.. took: 0.386s.
[fefgGet] Computing nodes-in-voxels.. took: 0.346s.
[fefgGet] fiber/node pairing completed in: 16.665s.

Files loaded: 
  dwi   = /home/frk/git/life/data/diffusion/life_demo_scan1_subject1_b2000_150dirs_stanford.nii.gz 
  bvecs = /home/frk/git/life/data/diffusion/life_demo_scan1_subject1_b2000_150dirs_stanford.bvecs 
  bvals = /home/frk/git/life/data/diffusion/life_demo_scan1_subject1_b2000_150dirs_stanford.bvals


Files loaded: 
  dwi   = /home/frk/git/life/data/diffusion/life_demo_scan2_subject1_b2000_150dirs_stanford.nii.gz 
  bvecs = /home/frk/git/life/data/diffusion/life_demo_scan2_subject1_b2000_150dirs_stanford.bvecs 
  bvals = /home/frk/git/life/data/diffusion/life_demo_scan2_subject1_b2000_150dirs_stanford.bvals

LiFE - Building the connectome model...
LiFE - Predicting diffusion signal in 10694 voxel...
LiFE - Prediction computed in: 84.629s.
LiFE - Allocating the model prediction...process completed in 253.797s.
LiFE - DONE Building the connectome model.
</pre><img vspace="5" hspace="5" src="life_demo_03.png" alt=""> <h2>Extract the coordinates of the white-matter voxels<a name="14"></a></h2><p>We will use this later to compare probabilistic and deterministic models.</p><pre class="codeinput">p.coords = feGet(fe,<span class="string">'roi coords'</span>);
clear <span class="string">fe</span>
</pre><h2>(2) Evaluate the Deterministic tensor-based connectome.<a name="15"></a></h2><p>We will now analyze the tensor-based Deterministic tractography connectome.</p><pre class="codeinput">det.tractography = <span class="string">'Deterministic'</span>;
fgFileName    = fullfile(lifeDemoDataPath(<span class="string">'tractography'</span>), <span class="keyword">...</span>
                <span class="string">'life_demo_mrtrix_tensor_deterministic.mat'</span>);

<span class="comment">% The final connectome and data astructure will be saved with this name:</span>
feFileName    = <span class="string">'life_build_model_demo_TENSOR_DET'</span>;
</pre><h2>(2.1) Initialize the LiFE model structure, 'fe' in the code below.<a name="16"></a></h2><p>This structure contains the forward model of diffusion based on the tractography solution. It also contains all the information necessary to compute model accuracry, and perform statistical tests. You can type help('feBuildModel') in the MatLab prompt for more information.</p><pre class="codeinput">fe = feConnectomeInit(dwiFile,fgFileName,feFileName,[],dwiFileRepeat,t1File);
</pre><pre class="codeoutput">
[feConnectomeInit]
 loading fiber from file: /home/frk/git/life/data/tractography/life_demo_mrtrix_tensor_deterministic.mat

[feConnectomeInit] Computing fibers' tensors... Elapsed time is 7.516978 seconds.
[fefgGet] Computing fibers/nodes pairing in each voxel..
[fefgGet] Computing nodes-to-voxels.. took: 0.912minutes.
[fefgGet] Computing voxels-in-fg.. took: 0.332s.
[fefgGet] Computing nodes-in-voxels.. took: 0.253s.
[fefgGet] fiber/node pairing completed in: 15.013s.

Files loaded: 
  dwi   = /home/frk/git/life/data/diffusion/life_demo_scan1_subject1_b2000_150dirs_stanford.nii.gz 
  bvecs = /home/frk/git/life/data/diffusion/life_demo_scan1_subject1_b2000_150dirs_stanford.bvecs 
  bvals = /home/frk/git/life/data/diffusion/life_demo_scan1_subject1_b2000_150dirs_stanford.bvals


Files loaded: 
  dwi   = /home/frk/git/life/data/diffusion/life_demo_scan2_subject1_b2000_150dirs_stanford.nii.gz 
  bvecs = /home/frk/git/life/data/diffusion/life_demo_scan2_subject1_b2000_150dirs_stanford.bvecs 
  bvals = /home/frk/git/life/data/diffusion/life_demo_scan2_subject1_b2000_150dirs_stanford.bvals

LiFE - Building the connectome model...
LiFE - Predicting diffusion signal in 7078 voxel...
LiFE - Prediction computed in: 44.882s.
LiFE - Allocating the model prediction...process completed in 112.861s.
LiFE - DONE Building the connectome model.
</pre><h2>(2.2) Fit the model.<a name="17"></a></h2><p>Hereafter we fit the forward model of tracrography using a least-squared method. The information generated by fitting the model (fiber weights etc) is then installed in the LiFE structure.</p><pre class="codeinput">fe = feSet(fe,<span class="string">'fit'</span>,feFitModel(feGet(fe,<span class="string">'mfiber'</span>),feGet(fe,<span class="string">'dsigdemeaned'</span>),<span class="string">'bbnnls'</span>));
</pre><pre class="codeoutput">
LiFE: Computing least-square minimization with BBNNLS...
Running: **** SBB-NNLS ****

Iter   	     Obj		  ||pg||_inf		 ||x-x*||
-------------------------------------------------------
0001	 9.970486E+08	5.684343E+07	NaN
0002	 9.679903E+08	2.263819E+07	NaN
0003	 9.512407E+08	1.784371E+07	NaN
0004	 9.338505E+08	1.511434E+07	NaN
0005	 9.297389E+08	1.609285E+07	NaN
0006	 9.258643E+08	1.776848E+07	NaN
0007	 9.235188E+08	1.368366E+07	NaN
0008	 9.210124E+08	9.679174E+06	NaN
0009	 9.105647E+08	9.348851E+06	NaN
0010	 9.144291E+08	8.318802E+06	NaN
0011	 9.011272E+08	4.183678E+07	NaN
0012	 9.005749E+08	7.291729E+06	NaN
0013	 9.000763E+08	7.039439E+06	NaN
0014	 8.968588E+08	7.000123E+06	NaN
0015	 8.959006E+08	8.719003E+06	NaN
0016	 8.954139E+08	6.535597E+06	NaN
0017	 8.951538E+08	6.510339E+06	NaN
0018	 8.943234E+08	6.494179E+06	NaN
0019	 8.936961E+08	6.414160E+06	NaN
0020	 9.182663E+08	6.340702E+06	NaN
0021	 8.848653E+08	6.519158E+07	NaN
0022	 8.838634E+08	5.718379E+06	NaN
0023	 8.829055E+08	4.864422E+06	NaN
0024	 8.821302E+08	4.899005E+06	NaN
0025	 8.816622E+08	4.895295E+06	NaN
0026	 8.811756E+08	4.855169E+06	NaN
0027	 8.806214E+08	5.937712E+06	NaN
0028	 8.804542E+08	4.738092E+06	NaN
0029	 8.802746E+08	4.714609E+06	NaN
0030	 9.153688E+08	4.685794E+06	NaN
0031	 8.783175E+08	3.034392E+07	NaN
0032	 8.763082E+08	1.513730E+07	NaN
0033	 8.757820E+08	7.925455E+06	NaN
0034	 8.745643E+08	6.648885E+06	NaN
0035	 8.739556E+08	5.699390E+06	NaN
0036	 8.727987E+08	5.258446E+06	NaN
0037	 8.716118E+08	1.244945E+07	NaN
0038	 8.714759E+08	3.596560E+06	NaN
0039	 8.713617E+08	3.529087E+06	NaN
0040	 8.700892E+08	3.460989E+06	NaN
0041	 8.701275E+08	6.955399E+06	NaN
0042	 8.698075E+08	8.286403E+06	NaN
0043	 8.697525E+08	4.165024E+06	NaN
0044	 8.696550E+08	2.760522E+06	NaN
0045	 8.695750E+08	4.235092E+06	NaN
0046	 8.695427E+08	2.185471E+06	NaN
0047	 8.695002E+08	2.169553E+06	NaN
0048	 8.694840E+08	2.145955E+06	NaN
0049	 8.687535E+08	9.354907E+06	NaN
0050	 8.687107E+08	1.858194E+06	NaN
0051	 8.686477E+08	1.880950E+06	NaN
0052	 8.682271E+08	1.913882E+06	NaN
0053	 8.681464E+08	2.044168E+06	NaN
0054	 8.681137E+08	1.971895E+06	NaN
0055	 8.680967E+08	1.956302E+06	NaN
0056	 8.678090E+08	1.948326E+06	NaN
0057	 8.677390E+08	1.758367E+06	NaN
0058	 8.677138E+08	1.696132E+06	NaN
0059	 8.676970E+08	1.697779E+06	NaN
0060	 8.672924E+08	1.698081E+06	NaN
0061	 8.663866E+08	1.017256E+07	NaN
0062	 8.662087E+08	3.193056E+06	NaN
0063	 8.661584E+08	1.317881E+06	NaN
0064	 8.660144E+08	1.217811E+06	NaN
0065	 8.659607E+08	1.301806E+06	NaN
0066	 8.658165E+08	1.143631E+06	NaN
0067	 8.657900E+08	1.149969E+06	NaN
0068	 8.656206E+08	1.142268E+06	NaN
0069	 8.655424E+08	1.099635E+06	NaN
0070	 8.654755E+08	1.107508E+06	NaN
0071	 8.653734E+08	4.657662E+06	NaN
0072	 8.653028E+08	4.163549E+06	NaN
0073	 8.652054E+08	3.463419E+06	NaN
0074	 8.651255E+08	2.169527E+06	NaN
0075	 8.651079E+08	1.040916E+06	NaN
0076	 8.651022E+08	1.921179E+06	NaN
0077	 8.650841E+08	2.675824E+06	NaN
0078	 8.650772E+08	1.293092E+06	NaN
0079	 8.650720E+08	1.048236E+06	NaN
0080	 8.650426E+08	9.974732E+05	NaN
0081	 8.650202E+08	2.220582E+06	NaN
0082	 8.650101E+08	9.904039E+05	NaN
0083	 8.649990E+08	9.881975E+05	NaN
0084	 8.647128E+08	9.854661E+05	NaN
0085	 8.640422E+08	1.141021E+07	NaN
0086	 8.640129E+08	2.809706E+06	NaN
0087	 8.640035E+08	1.471573E+06	NaN
0088	 8.640055E+08	1.304384E+06	NaN
0089	 8.639478E+08	2.993906E+06	NaN
0090	 8.639404E+08	7.288329E+05	NaN
0091	 8.639307E+08	6.763584E+05	NaN
0092	 8.638566E+08	6.343543E+05	NaN
0093	 8.638244E+08	1.993708E+06	NaN
0094	 8.638177E+08	1.014115E+06	NaN
0095	 8.638141E+08	6.284270E+05	NaN
0096	 8.637935E+08	6.270324E+05	NaN
0097	 8.637592E+08	1.929580E+06	NaN
0098	 8.637499E+08	5.998237E+05	NaN
0099	 8.637405E+08	6.007184E+05	NaN
0100	 8.632274E+08	6.009706E+05	NaN
0101	 8.631939E+08	1.565404E+06	NaN
0102	 8.631549E+08	2.816085E+06	NaN
0103	 8.631434E+08	1.837533E+06	NaN
0104	 8.631309E+08	1.111112E+06	NaN
0105	 8.631035E+08	2.111514E+06	NaN
0106	 8.630977E+08	6.417669E+05	NaN
0107	 8.630925E+08	5.824417E+05	NaN
0108	 8.631564E+08	5.661268E+05	NaN
0109	 8.630294E+08	3.306229E+06	NaN
0110	 8.630214E+08	6.416097E+05	NaN
0111	 8.630152E+08	4.542013E+05	NaN
0112	 8.629968E+08	4.531067E+05	NaN
0113	 8.629886E+08	4.491968E+05	NaN
0114	 8.629762E+08	4.864049E+05	NaN
0115	 8.629686E+08	1.213022E+06	NaN
0116	 8.629644E+08	4.471330E+05	NaN
0117	 8.629608E+08	4.467214E+05	NaN
0118	 8.627444E+08	4.463454E+05	NaN
0119	 8.627618E+08	1.237914E+06	NaN
0120	 8.627213E+08	2.583672E+06	NaN
0121	 8.627089E+08	1.398773E+06	NaN
0122	 8.627176E+08	1.120244E+06	NaN
0123	 8.626638E+08	2.471091E+06	NaN
0124	 8.626588E+08	5.952221E+05	NaN
0125	 8.626531E+08	4.991972E+05	NaN
0126	 8.626497E+08	4.590846E+05	NaN
0127	 8.626230E+08	1.336502E+06	NaN
0128	 8.626200E+08	4.269232E+05	NaN
0129	 8.626180E+08	3.223156E+05	NaN
0130	 8.626035E+08	3.221868E+05	NaN
0131	 8.625991E+08	4.580548E+05	NaN
0132	 8.625970E+08	3.673852E+05	NaN
0133	 8.625959E+08	2.821330E+05	NaN
0134	 8.625728E+08	3.008138E+05	NaN
0135	 8.625696E+08	3.666275E+05	NaN
0136	 8.625678E+08	4.258639E+05	NaN
0137	 8.625670E+08	3.067515E+05	NaN
0138	 8.626342E+08	3.166383E+05	NaN
0139	 8.625167E+08	3.466444E+06	NaN
0140	 8.625138E+08	6.735936E+05	NaN
0141	 8.625126E+08	3.730765E+05	NaN
0142	 8.625099E+08	2.996061E+05	NaN
0143	 8.625082E+08	4.646961E+05	NaN
0144	 8.625070E+08	2.660026E+05	NaN
0145	 8.625057E+08	2.435354E+05	NaN
0146	 8.624743E+08	2.501045E+05	NaN
0147	 8.624551E+08	1.694136E+06	NaN
0148	 8.624493E+08	5.169666E+05	NaN
0149	 8.624449E+08	3.615009E+05	NaN
0150	 8.624391E+08	2.775820E+05	NaN
0151	 8.624379E+08	3.020741E+05	NaN
0152	 8.624363E+08	2.314867E+05	NaN
0153	 8.624356E+08	2.972019E+05	NaN
0154	 8.624342E+08	2.476395E+05	NaN
0155	 8.624334E+08	2.288305E+05	NaN
0156	 8.624007E+08	2.333956E+05	NaN
0157	 8.624024E+08	5.134099E+05	NaN
0158	 8.623991E+08	8.667602E+05	NaN
0159	 8.623981E+08	5.346915E+05	NaN
0160	 8.623972E+08	3.145017E+05	NaN
0161	 8.623952E+08	6.666039E+05	NaN
0162	 8.623947E+08	2.126003E+05	NaN
0163	 8.623941E+08	1.982233E+05	NaN
0164	 8.623795E+08	1.916036E+05	NaN
0165	 8.623746E+08	1.414292E+06	NaN
0166	 8.623709E+08	1.007872E+06	NaN
0167	 8.623696E+08	5.585210E+05	NaN
0168	 8.623674E+08	3.968771E+05	NaN
0169	 8.623662E+08	6.788296E+05	NaN
0170	 8.623655E+08	2.467823E+05	NaN
0171	 8.623649E+08	2.244313E+05	NaN
0172	 8.623604E+08	2.182950E+05	NaN
0173	 8.623573E+08	7.604120E+05	NaN
0174	 8.623563E+08	4.220279E+05	NaN
0175	 8.623560E+08	2.797296E+05	NaN
0176	 8.623544E+08	1.647350E+05	NaN
0177	 8.623535E+08	3.487917E+05	NaN
0178	 8.623531E+08	1.664629E+05	NaN
0179	 8.623525E+08	1.629449E+05	NaN
0180	 8.623388E+08	1.634681E+05	NaN
0181	 8.624102E+08	2.015601E+06	NaN
0182	 8.623640E+08	4.095222E+06	NaN
0183	 8.623543E+08	2.213009E+06	NaN
0184	 8.623491E+08	1.457731E+06	NaN
0185	 8.623279E+08	2.866176E+06	NaN
0186	 8.623250E+08	6.237169E+05	NaN
0187	 8.623219E+08	5.964396E+05	NaN
0188	 8.623165E+08	5.206301E+05	NaN
0189	 8.623103E+08	1.327358E+06	NaN
0190	 8.623094E+08	3.327700E+05	NaN
0191	 8.623085E+08	3.054805E+05	NaN
0192	 8.623145E+08	3.140094E+05	NaN
0193	 8.623013E+08	1.612049E+06	NaN
0194	 8.623009E+08	2.345920E+05	NaN
0195	 8.623007E+08	1.227193E+05	NaN
0196	 8.622990E+08	1.178076E+05	NaN
0197	 8.622985E+08	1.707486E+05	NaN
0198	 8.622982E+08	1.538877E+05	NaN
0199	 8.622978E+08	2.785259E+05	NaN
0200	 8.622976E+08	1.179404E+05	NaN
0201	 8.622973E+08	1.196160E+05	NaN
0202	 8.622953E+08	1.176823E+05	NaN
0203	 8.622838E+08	2.196820E+06	NaN
0204	 8.622796E+08	9.799073E+05	NaN
0205	 8.622782E+08	6.133420E+05	NaN
0206	 8.622762E+08	5.437841E+05	NaN
0207	 8.622750E+08	5.368677E+05	NaN
0208	 8.622743E+08	2.375145E+05	NaN
0209	 8.622737E+08	1.869416E+05	NaN
0210	 8.622718E+08	1.628804E+05	NaN
0211	 8.622706E+08	5.092391E+05	NaN
0212	 8.622698E+08	4.447365E+05	NaN
0213	 8.622696E+08	3.054853E+05	NaN
0214	 8.622693E+08	1.269642E+05	NaN
0215	 8.622689E+08	2.818422E+05	NaN
0216	 8.622687E+08	1.136120E+05	NaN
0217	 8.622685E+08	1.134935E+05	NaN
0218	 8.622649E+08	1.132943E+05	NaN
0219	 8.622694E+08	5.925096E+05	NaN
0220	 8.622657E+08	9.037183E+05	NaN
0221	 8.622647E+08	5.633823E+05	NaN
0222	 8.622649E+08	3.084586E+05	NaN
0223	 8.622627E+08	7.143878E+05	NaN
0224	 8.622626E+08	1.443627E+05	NaN
0225	 8.622623E+08	1.352508E+05	NaN
0226	 8.622617E+08	1.152961E+05	NaN
0227	 8.622615E+08	1.147976E+05	NaN
0228	 8.622613E+08	7.794531E+04	NaN
0229	 8.622612E+08	8.856182E+04	NaN
0230	 8.622611E+08	7.223287E+04	NaN
0231	 8.622610E+08	7.015892E+04	NaN
0232	 8.622592E+08	7.202013E+04	NaN
0233	 8.622589E+08	1.627258E+05	NaN
0234	 8.622589E+08	9.619977E+04	NaN
0235	 8.622588E+08	6.526345E+04	NaN
0236	 8.622567E+08	6.497513E+04	NaN
0237	 8.622565E+08	8.865107E+04	NaN
0238	 8.622565E+08	8.288799E+04	NaN
0239	 8.622564E+08	5.601329E+04	NaN
0240	 8.622561E+08	5.606779E+04	NaN
0241	 8.622560E+08	5.994205E+04	NaN
0242	 8.622561E+08	6.002538E+04	NaN
0243	 8.622557E+08	2.543044E+05	NaN
0244	 8.622557E+08	1.645213E+05	NaN
0245	 8.622556E+08	7.862102E+04	NaN
0246	 8.622552E+08	7.476035E+04	NaN
0247	 8.622550E+08	1.866639E+05	NaN
0248	 8.622550E+08	5.765523E+04	NaN
0249	 8.622549E+08	5.753691E+04	NaN
0250	 8.622514E+08	5.745703E+04	NaN
0251	 8.622493E+08	7.571231E+05	NaN
0252	 8.622467E+08	6.564829E+05	NaN
0253	 8.622458E+08	4.121277E+05	NaN
0254	 8.622458E+08	2.781066E+05	NaN
0255	 8.622452E+08	4.874996E+05	NaN
0256	 8.622451E+08	1.791359E+05	NaN
0257	 8.622450E+08	1.657749E+05	NaN
0258	 8.622444E+08	1.459078E+05	NaN
0259	 8.622446E+08	6.610043E+04	NaN
0260	 8.622445E+08	2.501642E+05	NaN
0261	 8.622441E+08	3.894027E+05	NaN
0262	 8.622441E+08	9.373567E+04	NaN
0263	 8.622441E+08	5.666218E+04	NaN
0264	 8.622437E+08	4.479208E+04	NaN
0265	 8.622437E+08	4.702433E+04	NaN
0266	 8.622436E+08	4.815661E+04	NaN
0267	 8.622436E+08	5.317856E+04	NaN
0268	 8.622436E+08	4.399640E+04	NaN
0269	 8.622436E+08	4.402381E+04	NaN
0270	 8.622425E+08	4.408034E+04	NaN
0271	 8.622425E+08	1.329013E+05	NaN
0272	 8.622424E+08	1.716652E+05	NaN
0273	 8.622424E+08	1.003971E+05	NaN
0274	 8.622423E+08	6.519448E+04	NaN
0275	 8.622422E+08	1.556269E+05	NaN
0276	 8.622422E+08	4.371717E+04	NaN
0277	 8.622422E+08	4.372773E+04	NaN
0278	 8.622417E+08	4.378084E+04	NaN
0279	 8.622415E+08	7.334187E+04	NaN
0280	 8.622415E+08	4.660301E+04	NaN
0281	 8.622414E+08	9.478336E+04	NaN
0282	 8.622414E+08	4.458373E+04	NaN
0283	 8.622414E+08	4.451401E+04	NaN
0284	 8.622414E+08	4.454492E+04	NaN
0285	 8.622413E+08	4.445058E+04	NaN
0286	 8.622412E+08	4.424322E+04	NaN
0287	 8.622409E+08	2.739180E+05	NaN
0288	 8.622409E+08	4.344067E+04	NaN
0289	 8.622409E+08	4.340287E+04	NaN
0290	 8.622408E+08	4.345085E+04	NaN
0291	 8.622408E+08	4.391023E+04	NaN
0292	 8.622407E+08	4.399226E+04	NaN
0293	 8.622407E+08	4.383589E+04	NaN
0294	 8.622407E+08	4.399306E+04	NaN
0295	 8.622407E+08	4.377896E+04	NaN
0296	 8.622407E+08	4.390455E+04	NaN
0297	 8.622406E+08	4.392616E+04	NaN
0298	 8.622393E+08	4.391045E+04	NaN
0299	 8.622410E+08	2.470879E+05	NaN
0300	 8.622396E+08	6.266204E+05	NaN
0301	 8.622393E+08	4.080130E+05	NaN
0302	 8.622398E+08	1.795736E+05	NaN
0303	 8.622389E+08	4.708443E+05	NaN
0304	 8.622389E+08	7.942220E+04	NaN
0305	 8.622389E+08	6.916611E+04	NaN
0306	 8.622389E+08	6.535919E+04	NaN
0307	 8.622388E+08	1.316311E+05	NaN
0308	 8.622388E+08	2.453764E+04	NaN
0309	 8.622388E+08	2.439495E+04	NaN
0310	 8.622388E+08	2.425724E+04	NaN
0311	 8.622387E+08	2.215738E+04	NaN
0312	 8.622387E+08	2.195720E+04	NaN
0313	 8.622387E+08	2.378705E+04	NaN
0314	 8.622387E+08	2.166767E+04	NaN
0315	 8.622387E+08	2.152321E+04	NaN
0316	 8.622386E+08	2.144501E+04	NaN
0317	 8.622386E+08	1.945481E+04	NaN
0318	 8.622386E+08	3.641290E+04	NaN
0319	 8.622385E+08	4.985863E+04	NaN
0320	 8.622385E+08	1.886769E+04	NaN
0321	 8.622385E+08	1.886812E+04	NaN
0322	 8.622490E+08	1.886896E+04	NaN
0323	 8.622441E+08	8.387867E+05	NaN
0324	 8.622411E+08	5.325247E+05	NaN
0325	 8.622399E+08	3.037647E+05	NaN
0326	 8.622398E+08	2.588600E+05	NaN
0327	 8.622390E+08	4.471549E+05	NaN
0328	 8.622388E+08	2.242758E+05	NaN
0329	 8.622385E+08	2.155361E+05	NaN
0330	 8.622378E+08	1.960519E+05	NaN
0331	 8.622374E+08	3.111339E+05	NaN
0332	 8.622374E+08	2.200376E+05	NaN
0333	 8.622373E+08	8.950856E+04	NaN
0334	 8.622372E+08	8.888388E+04	NaN
0335	 8.622372E+08	8.427950E+04	NaN
0336	 8.622372E+08	8.250555E+04	NaN
0337	 8.622372E+08	8.067809E+04	NaN
0338	 8.622371E+08	7.970098E+04	NaN
0339	 8.622370E+08	7.655368E+04	NaN
0340	 8.622489E+08	6.308653E+04	NaN
0341	 8.622366E+08	1.207363E+06	NaN
0342	 8.622366E+08	6.267289E+04	NaN
0343	 8.622366E+08	2.199281E+04	NaN
0344	 8.622366E+08	2.193661E+04	NaN
0345	 8.622366E+08	2.169951E+04	NaN
0346	 8.622369E+08	2.097677E+04	NaN
0347	 8.622365E+08	2.040682E+05	NaN
0348	 8.622365E+08	1.105287E+05	NaN
0349	 8.622365E+08	4.761342E+04	NaN
0350	 8.622365E+08	4.103249E+04	NaN
0351	 8.622365E+08	1.498342E+04	NaN
0352	 8.622364E+08	1.682370E+04	NaN
0353	 8.622364E+08	3.253081E+04	NaN
0354	 8.622364E+08	1.508779E+04	NaN
0355	 8.622364E+08	1.508913E+04	NaN
0356	 8.622363E+08	1.509019E+04	NaN
0357	 8.622364E+08	1.517468E+04	NaN
0358	 8.622364E+08	7.090296E+04	NaN
0359	 8.622363E+08	8.487602E+04	NaN
0360	 8.622363E+08	6.045046E+04	NaN
0361	 8.622363E+08	2.684573E+04	NaN
0362	 8.622363E+08	1.507161E+04	NaN
0363	 8.622363E+08	1.506830E+04	NaN
0364	 8.622363E+08	1.506660E+04	NaN
0365	 8.622363E+08	1.504896E+04	NaN
0366	 8.622363E+08	1.504875E+04	NaN
0367	 8.622363E+08	1.504855E+04	NaN
0368	 8.622363E+08	1.504844E+04	NaN
0369	 8.622363E+08	1.504753E+04	NaN
0370	 8.622363E+08	1.504736E+04	NaN
0371	 8.622363E+08	7.925171E+04	NaN
0372	 8.622363E+08	6.658518E+04	NaN
0373	 8.622363E+08	1.504508E+04	NaN
0374	 8.622363E+08	1.504490E+04	NaN
0375	 8.622363E+08	1.504378E+04	NaN
0376	 8.622363E+08	1.504356E+04	NaN
0377	 8.622363E+08	1.504276E+04	NaN
0378	 8.622363E+08	1.504255E+04	NaN
0379	 8.622363E+08	1.503904E+04	NaN
0380	 8.622363E+08	1.503886E+04	NaN
0381	 8.622363E+08	1.503872E+04	NaN
0382	 8.622362E+08	1.503860E+04	NaN
0383	 8.622362E+08	1.503680E+04	NaN
0384	 8.622363E+08	1.503593E+04	NaN
0385	 8.622362E+08	1.080398E+05	NaN
0386	 8.622362E+08	6.258261E+04	NaN
0387	 8.622362E+08	4.432424E+04	NaN
0388	 8.622362E+08	1.502675E+04	NaN
0389	 8.622362E+08	1.502660E+04	NaN
0390	 8.622362E+08	1.506322E+04	NaN
0391	 8.622362E+08	1.868195E+04	NaN
0392	 8.622362E+08	1.502474E+04	NaN
0393	 8.622362E+08	1.502466E+04	NaN
0394	 8.622362E+08	1.502461E+04	NaN
0395	 8.622362E+08	1.502451E+04	NaN
0396	 8.622361E+08	1.502435E+04	NaN
0397	 8.622361E+08	6.812693E+04	NaN
0398	 8.622361E+08	6.824763E+04	NaN
0399	 8.622361E+08	4.164149E+04	NaN
0400	 8.622361E+08	1.501344E+04	NaN
0401	 8.622361E+08	1.501341E+04	NaN
0402	 8.622361E+08	1.501340E+04	NaN
0403	 8.622361E+08	4.357895E+04	NaN
0404	 8.622361E+08	1.501324E+04	NaN
0405	 8.622361E+08	1.501322E+04	NaN
0406	 8.622360E+08	1.501319E+04	NaN
0407	 8.622360E+08	1.501011E+04	NaN
0408	 8.622360E+08	1.501021E+04	NaN
0409	 8.622360E+08	1.501022E+04	NaN
0410	 8.622360E+08	1.501022E+04	NaN
0411	 8.622360E+08	1.501022E+04	NaN
0412	 8.622360E+08	1.501021E+04	NaN
0413	 8.622360E+08	1.501004E+04	NaN
0414	 8.622360E+08	1.500989E+04	NaN
0415	 8.622360E+08	5.882415E+04	NaN
0416	 8.622360E+08	1.500959E+04	NaN
0417	 8.622360E+08	1.500957E+04	NaN
0418	 8.622360E+08	1.500955E+04	NaN
0419	 8.622360E+08	1.500722E+04	NaN
0420	 8.622360E+08	1.500711E+04	NaN
0421	 8.622360E+08	1.500702E+04	NaN
0422	 8.622360E+08	1.500699E+04	NaN
0423	 8.622360E+08	1.500687E+04	NaN
0424	 8.622360E+08	1.500685E+04	NaN
0425	 8.622360E+08	1.500675E+04	NaN
0426	 8.622360E+08	1.500674E+04	NaN
0427	 8.622360E+08	1.500639E+04	NaN
0428	 8.622360E+08	1.500638E+04	NaN
0429	 8.622360E+08	1.500636E+04	NaN
0430	 8.622359E+08	1.500634E+04	NaN
0431	 8.622358E+08	5.370253E+04	NaN
0432	 8.622358E+08	4.691800E+04	NaN
0433	 8.622358E+08	4.241425E+04	NaN
0434	 8.622358E+08	4.080162E+04	NaN
0435	 8.622358E+08	3.916612E+04	NaN
0436	 8.622358E+08	3.564254E+04	NaN
0437	 8.622359E+08	1.055248E+04	NaN
0438	 8.622359E+08	7.359027E+04	NaN
0439	 8.622358E+08	1.009533E+05	NaN
0440	 8.622358E+08	1.568999E+04	NaN
0441	 8.622358E+08	1.013283E+04	NaN
0442	 8.622358E+08	1.007772E+04	NaN
0443	 8.622358E+08	9.286153E+03	NaN
0444	 8.622358E+08	9.152211E+03	NaN
0445	 8.622358E+08	2.215638E+04	NaN
0446	 8.622358E+08	8.921513E+03	NaN
0447	 8.622358E+08	8.892419E+03	NaN
0448	 8.622358E+08	8.864519E+03	NaN
0449	 8.622358E+08	8.495090E+03	NaN
0450	 8.622358E+08	8.464266E+03	NaN
0451	 8.622358E+08	8.435960E+03	NaN
0452	 8.622358E+08	8.424516E+03	NaN
0453	 8.622358E+08	8.409100E+03	NaN
0454	 8.622357E+08	8.396431E+03	NaN
0455	 8.622357E+08	2.033556E+04	NaN
0456	 8.622357E+08	6.982160E+04	NaN
0457	 8.622357E+08	6.240208E+04	NaN
0458	 8.622357E+08	1.258742E+04	NaN
0459	 8.622357E+08	1.244297E+04	NaN
0460	 8.622357E+08	1.209426E+04	NaN
0461	 8.622357E+08	8.414928E+03	NaN
0462	 8.622357E+08	1.488886E+04	NaN
0463	 8.622357E+08	2.402916E+04	NaN
0464	 8.622357E+08	1.436170E+04	NaN
0465	 8.622357E+08	8.024100E+03	NaN
0466	 8.622357E+08	8.004848E+03	NaN
0467	 8.622357E+08	9.409302E+03	NaN
0468	 8.622357E+08	8.635439E+03	NaN
0469	 8.622357E+08	8.621290E+03	NaN
0470	 8.622357E+08	8.612745E+03	NaN
0471	 8.622357E+08	8.600465E+03	NaN
0472	 8.622357E+08	8.589958E+03	NaN
0473	 8.622357E+08	1.506638E+04	NaN
0474	 8.622357E+08	1.795682E+04	NaN
0475	 8.622357E+08	8.727087E+03	NaN
0476	 8.622357E+08	8.564002E+03	NaN
0477	 8.622356E+08	8.556469E+03	NaN
0478	 8.622356E+08	8.524976E+03	NaN
0479	 8.622356E+08	8.302239E+03	NaN
0480	 8.622357E+08	1.259568E+04	NaN
0481	 8.622356E+08	3.341224E+04	NaN
0482	 8.622356E+08	8.127007E+03	NaN
0483	 8.622356E+08	8.115455E+03	NaN
0484	 8.622356E+08	8.102417E+03	NaN
0485	 8.622356E+08	1.185371E+04	NaN
0486	 8.622356E+08	9.893454E+03	NaN
0487	 8.622356E+08	9.628580E+03	NaN
0488	 8.622356E+08	9.496611E+03	NaN
0489	 8.622356E+08	9.241056E+03	NaN
0490	 8.622356E+08	9.166295E+03	NaN
0491	 8.622356E+08	9.061880E+03	NaN
0492	 8.622356E+08	9.011576E+03	NaN
0493	 8.622356E+08	8.736537E+03	NaN
0494	 8.622356E+08	8.624898E+03	NaN
0495	 8.622356E+08	2.811689E+04	NaN
0496	 8.622356E+08	8.346927E+03	NaN
0497	 8.622356E+08	8.333368E+03	NaN
0498	 8.622361E+08	8.316532E+03	NaN
0499	 8.622354E+08	3.405103E+05	NaN
BBNNLS status: Success
Reason: Maximum number of iterations reached
 ...fit process completed in 5.852minutes
</pre><h2>(2.3) Extract the RMSE of the model on the fitted data set.<a name="18"></a></h2><p>We now use the LiFE structure and the fit to compute the error in each white-matter voxel spanned by the tractography model.</p><pre class="codeinput">det.rmse   = feGet(fe,<span class="string">'vox rmse'</span>);
</pre><h2>(2.4) Extract the RMSE of the model on the second data set.<a name="19"></a></h2><p>Here we show how to compute the cross-valdiated RMSE of the tractography model in each white-matter voxel. We store this information for later use and to save computer memory.</p><pre class="codeinput">det.rmsexv = feGetRep(fe,<span class="string">'vox rmse'</span>);
</pre><h2>(2.5) Extract the Rrmse.<a name="20"></a></h2><p>We show how to extract the ratio between the model prediction error (RMSE) and the test-retest reliability of the data.</p><pre class="codeinput">det.rrmse  = feGetRep(fe,<span class="string">'vox rmse ratio'</span>);
</pre><h2>(2.6) Extract the fitted weights for the fascicles.<a name="21"></a></h2><p>The following line shows how to extract the weight assigned to each fascicle in the connectome.</p><pre class="codeinput">det.w      = feGet(fe,<span class="string">'fiber weights'</span>);
</pre><h2>(2.7) Plot a histogram of the RMSE.<a name="22"></a></h2><p>We plot the histogram of  RMSE across white-mater voxels.</p><pre class="codeinput">[fh(1), ~, ~] = plotHistRMSE(det);
</pre><img vspace="5" hspace="5" src="life_demo_04.png" alt=""> <h2>(2.8) Plot a histogram of the RMSE ratio.<a name="23"></a></h2><p>As a reminder the Rrmse is the ratio between data test-retest reliability and model error (the quality of the model fit).</p><pre class="codeinput">[fh(2), ~] = plotHistRrmse(det);
</pre><img vspace="5" hspace="5" src="life_demo_05.png" alt=""> <h2>(2.9) Plot a histogram of the fitted fascicle weights.<a name="24"></a></h2><pre class="codeinput">[fh(3), ~] = plotHistWeights(det);
</pre><img vspace="5" hspace="5" src="life_demo_06.png" alt=""> <h2>Extract the coordinates of the white-matter voxels.<a name="25"></a></h2><p>We will use this later to compare probabilistic and deterministic models.</p><pre class="codeinput">d.coords = feGet( fe, <span class="string">'roi coords'</span>);
clear <span class="string">fe</span>
</pre><h2>(3) Compare the quality of fit of Probabilistic and Deterministic connectomes.<a name="26"></a></h2><h2>(3.1) Find the common coordinates between the two connectomes.<a name="27"></a></h2><p>The two tractography method might have passed through slightly different white-matter voxels. Here we find the voxels where both models passed. We will compare the error only in these common voxels. There are more coordinates in the Prob connectome, because the tracking fills up more White-matter.</p><p>So, hereafter: - First we find the indices in the probabilistic connectome of the coordinate in the deterministic connectome. But there are some of the coordinates in the Deterministic conectome that are NOT in the Probabilistic connectome.</p><p>- Second we find the indices in the Deterministic connectome of the subset of coordinates in the Probabilistic connectome found in the previous step.</p><p>- Third we find the common voxels. These allow us to find the rmse for the same voxels.</p><pre class="codeinput">fprintf(<span class="string">'Finding common brain coordinates between P and D connectomes...\n'</span>)
prob.coordsIdx = ismember(p.coords,d.coords,<span class="string">'rows'</span>);
prob.coords    = p.coords(prob.coordsIdx,:);
det.coordsIdx  = ismember(d.coords,prob.coords,<span class="string">'rows'</span>);
det.coords     = d.coords(det.coordsIdx,:);
prob.rmse      = prob.rmse( prob.coordsIdx);
det.rmse       = det.rmse( det.coordsIdx);
clear <span class="string">p</span> <span class="string">d</span>
</pre><pre class="codeoutput">Finding common brain coordinates between P and D connectomes...
</pre><h2>(3.2) Make a scatter plot of the RMSE of the two tractography models<a name="28"></a></h2><pre class="codeinput">fh(4) = scatterPlotRMSE(det,prob);
</pre><img vspace="5" hspace="5" src="life_demo_07.png" alt=""> <h2>(3.3) Compute the strength-of-evidence (S) and the Earth Movers Distance.<a name="29"></a></h2><p>Compare the RMSE of the two models using the Stregth-of-evidence and the Earth Movers Distance.</p><pre class="codeinput">se = feComputeEvidence(prob.rmse,det.rmse);
</pre><pre class="codeoutput">[feComputeEvidence] Computing the Earth Mover's distance... 
[feComputeEvidence] Computing the Strength of Evidence... 
..... done.
</pre><h2>(3.4) Strength of evidence in favor of Probabilistic tractography.<a name="30"></a></h2><p>Plot the distributions of resampled mean RMSE used to compute the strength of evidence (S).</p><pre class="codeinput">fh(5) = distributionPlotStrengthOfEvidence(se);
</pre><img vspace="5" hspace="5" src="life_demo_08.png" alt=""> <h2>(3.5) RMSE distributions for Probabilistic and Deterministic tractography.<a name="31"></a></h2><p>Compare the distributions using the Earth Movers Distance. Plot the distributions of RMSE for the two models and report the Earth Movers Distance between the distributions.</p><pre class="codeinput">fh(6) = distributionPlotEarthMoversDistance(se);
</pre><img vspace="5" hspace="5" src="life_demo_09.png" alt=""> <pre class="codeinput"><span class="keyword">end</span>

<span class="comment">% ---------- Local Plot Functions ----------- %</span>
<span class="keyword">function</span> [fh, rmse, rmsexv] = plotHistRMSE(info)
<span class="comment">% Make a plot of the RMSE:</span>
rmse   = info.rmse;
rmsexv = info.rmsexv;

figName = sprintf(<span class="string">'%s - RMSE'</span>,info.tractography);
fh = mrvNewGraphWin(figName);
[y,x] = hist(rmse,50);
plot(x,y,<span class="string">'k-'</span>);
hold <span class="string">on</span>
[y,x] = hist(rmsexv,50);
plot(x,y,<span class="string">'r-'</span>);
set(gca,<span class="string">'tickdir'</span>,<span class="string">'out'</span>,<span class="string">'fontsize'</span>,16,<span class="string">'box'</span>,<span class="string">'off'</span>);
title(<span class="string">'Root-mean squared error distribution across voxels'</span>,<span class="string">'fontsize'</span>,16);
ylabel(<span class="string">'number of voxels'</span>,<span class="string">'fontsize'</span>,16);
xlabel(<span class="string">'rmse (scanner units)'</span>,<span class="string">'fontsize'</span>,16);
legend({<span class="string">'RMSE fitted data set'</span>,<span class="string">'RMSE cross-validated'</span>},<span class="string">'fontsize'</span>,16);
<span class="keyword">end</span>

<span class="keyword">function</span> [fh, R] = plotHistRrmse(info)
<span class="comment">% Make a plot of the RMSE Ratio:</span>

R       = info.rrmse;
figName = sprintf(<span class="string">'%s - RMSE RATIO'</span>,info.tractography);
fh      = mrvNewGraphWin(figName);
[y,x]   = hist(R,linspace(.5,4,50));
plot(x,y,<span class="string">'k-'</span>,<span class="string">'linewidth'</span>,2);
hold <span class="string">on</span>
plot([median(R) median(R)],[0 1200],<span class="string">'r-'</span>,<span class="string">'linewidth'</span>,2);
plot([1 1],[0 1200],<span class="string">'k-'</span>);
set(gca,<span class="string">'tickdir'</span>,<span class="string">'out'</span>,<span class="string">'fontsize'</span>,16,<span class="string">'box'</span>,<span class="string">'off'</span>);
title(<span class="string">'Root-mean squared error ratio'</span>,<span class="string">'fontsize'</span>,16);
ylabel(<span class="string">'number of voxels'</span>,<span class="string">'fontsize'</span>,16);
xlabel(<span class="string">'R_{rmse}'</span>,<span class="string">'fontsize'</span>,16);
legend({sprintf(<span class="string">'Distribution of R_{rmse}'</span>),sprintf(<span class="string">'Median R_{rmse}'</span>)});
<span class="keyword">end</span>

<span class="keyword">function</span> [fh, w] = plotHistWeights(info)
<span class="comment">% Make a plot of the weights:</span>

w       = info.w;
figName = sprintf(<span class="string">'%s - Distribution of fascicle weights'</span>,info.tractography);
fh      = mrvNewGraphWin(figName);
[y,x]   = hist(w( w &gt; 0 ),logspace(-5,-.3,40));
semilogx(x,y,<span class="string">'k-'</span>,<span class="string">'linewidth'</span>,2)
set(gca,<span class="string">'tickdir'</span>,<span class="string">'out'</span>,<span class="string">'fontsize'</span>,16,<span class="string">'box'</span>,<span class="string">'off'</span>)
title( <span class="keyword">...</span>
    sprintf(<span class="string">'Number of fascicles candidate connectome: %2.0f\nNumber of fascicles in optimized connetome: %2.0f'</span> <span class="keyword">...</span>
    ,length(w),sum(w &gt; 0)),<span class="string">'fontsize'</span>,16)
ylabel(<span class="string">'Number of fascicles'</span>,<span class="string">'fontsize'</span>,16)
xlabel(<span class="string">'Fascicle weight'</span>,<span class="string">'fontsize'</span>,16)
<span class="keyword">end</span>

<span class="keyword">function</span> fh = scatterPlotRMSE(det,prob)
figNameRmse = sprintf(<span class="string">'prob_vs_det_rmse_common_voxels_map'</span>);
fh = mrvNewGraphWin(figNameRmse);
[ymap,x]  = hist3([det.rmse;prob.rmse]',{[10:1:70], [10:1:70]});
ymap = ymap./length(prob.rmse);
sh   = imagesc(flipud(log10(ymap)));
cm   = colormap(flipud(hot)); view(0,90);
axis(<span class="string">'square'</span>)
set(gca, <span class="keyword">...</span>
    <span class="string">'xlim'</span>,[1 length(x{1})],<span class="keyword">...</span>
    <span class="string">'ylim'</span>,[1 length(x{1})], <span class="keyword">...</span>
    <span class="string">'ytick'</span>,[1 (length(x{1})/2) length(x{1})], <span class="keyword">...</span>
    <span class="string">'xtick'</span>,[1 (length(x{1})/2) length(x{1})], <span class="keyword">...</span>
    <span class="string">'yticklabel'</span>,[x{1}(end) x{1}(round(end/2)) x{1}(1)], <span class="keyword">...</span>
    <span class="string">'xticklabel'</span>,[x{1}(1)   x{1}(round(end/2)) x{1}(end)], <span class="keyword">...</span>
    <span class="string">'tickdir'</span>,<span class="string">'out'</span>,<span class="string">'ticklen'</span>,[.025 .05],<span class="string">'box'</span>,<span class="string">'off'</span>, <span class="keyword">...</span>
    <span class="string">'fontsize'</span>,16,<span class="string">'visible'</span>,<span class="string">'on'</span>)
hold <span class="string">on</span>
plot3([1 length(x{1})],[length(x{1}) 1],[max(ymap(:)) max(ymap(:))],<span class="string">'k-'</span>,<span class="string">'linewidth'</span>,1)
ylabel(<span class="string">'Deterministic_{rmse}'</span>,<span class="string">'fontsize'</span>,16)
xlabel(<span class="string">'Probabilistic_{rmse}'</span>,<span class="string">'fontsize'</span>,16)
cb = colorbar;
tck = get(cb,<span class="string">'ytick'</span>);
set(cb,<span class="string">'yTick'</span>,[min(tck)  mean(tck) max(tck)], <span class="keyword">...</span>
    <span class="string">'yTickLabel'</span>,round(1000*10.^[min(tck),<span class="keyword">...</span>
    mean(tck), <span class="keyword">...</span>
    max(tck)])/1000, <span class="keyword">...</span>
    <span class="string">'tickdir'</span>,<span class="string">'out'</span>,<span class="string">'ticklen'</span>,[.025 .05],<span class="string">'box'</span>,<span class="string">'on'</span>, <span class="keyword">...</span>
    <span class="string">'fontsize'</span>,16,<span class="string">'visible'</span>,<span class="string">'on'</span>)
<span class="keyword">end</span>

<span class="keyword">function</span> fh = distributionPlotStrengthOfEvidence(se)

y_e        = se.s.unlesioned_e;
ywo_e      = se.s.lesioned_e;
dprime     = se.s.mean;
std_dprime = se.s.std;
xhis       = se.s.unlesioned.xbins;
woxhis     = se.s.lesioned.xbins;

histcolor{1} = [0 0 0];
histcolor{2} = [.95 .6 .5];
figName = sprintf(<span class="string">'Strength_of_Evidence_test_PROB_vs_DET_model_rmse_mean_HIST'</span>);
fh = mrvNewGraphWin(figName);
patch([xhis,xhis],y_e(:),histcolor{1},<span class="string">'FaceColor'</span>,histcolor{1},<span class="string">'EdgeColor'</span>,histcolor{1});
hold <span class="string">on</span>
patch([woxhis,woxhis],ywo_e(:),histcolor{2},<span class="string">'FaceColor'</span>,histcolor{2},<span class="string">'EdgeColor'</span>,histcolor{2});
set(gca,<span class="string">'tickdir'</span>,<span class="string">'out'</span>, <span class="keyword">...</span>
        <span class="string">'box'</span>,<span class="string">'off'</span>, <span class="keyword">...</span>
        <span class="string">'ticklen'</span>,[.025 .05], <span class="keyword">...</span>
        <span class="string">'ylim'</span>,[0 .2], <span class="keyword">...</span>
        <span class="string">'xlim'</span>,[min(xhis) max(woxhis)], <span class="keyword">...</span>
        <span class="string">'xtick'</span>,[min(xhis) round(mean([xhis, woxhis])) max(woxhis)], <span class="keyword">...</span>
        <span class="string">'ytick'</span>,[0 .1 .2], <span class="keyword">...</span>
        <span class="string">'fontsize'</span>,16)
ylabel(<span class="string">'Probability'</span>,<span class="string">'fontsize'</span>,16)
xlabel(<span class="string">'rmse'</span>,<span class="string">'fontsize'</span>,16')

title(sprintf(<span class="string">'Strength of evidence:\n mean %2.3f - std %2.3f'</span>,dprime,std_dprime), <span class="keyword">...</span>
    <span class="string">'FontSize'</span>,16)
legend({<span class="string">'Probabilistic'</span>,<span class="string">'Deterministic'</span>})
<span class="keyword">end</span>

<span class="keyword">function</span> fh = distributionPlotEarthMoversDistance(se)

prob = se.nolesion;
det  = se.lesion;
em   = se.em;

histcolor{1} = [0 0 0];
histcolor{2} = [.95 .6 .5];
figName = sprintf(<span class="string">'EMD_PROB_DET_model_rmse_mean_HIST'</span>);
fh = mrvNewGraphWin(figName);
plot(prob.xhist,prob.hist,<span class="string">'r-'</span>,<span class="string">'color'</span>,histcolor{1},<span class="string">'linewidth'</span>,4);
hold <span class="string">on</span>
plot(det.xhist,det.hist,<span class="string">'r-'</span>,<span class="string">'color'</span>,histcolor{2},<span class="string">'linewidth'</span>,4);
set(gca,<span class="string">'tickdir'</span>,<span class="string">'out'</span>, <span class="keyword">...</span>
        <span class="string">'box'</span>,<span class="string">'off'</span>, <span class="keyword">...</span>
        <span class="string">'ticklen'</span>,[.025 .05], <span class="keyword">...</span>
        <span class="string">'ylim'</span>,[0 .12], <span class="keyword">...</span>
        <span class="string">'xlim'</span>,[0 95], <span class="keyword">...</span>
        <span class="string">'xtick'</span>,[0 45 90], <span class="keyword">...</span>
        <span class="string">'ytick'</span>,[0 .06 .12], <span class="keyword">...</span>
        <span class="string">'fontsize'</span>,16)
ylabel(<span class="string">'Proportion white-matter volume'</span>,<span class="string">'fontsize'</span>,16)
xlabel(<span class="string">'RMSE (raw MRI scanner units)'</span>,<span class="string">'fontsize'</span>,16')
title(sprintf(<span class="string">'Earth Movers Distance: %2.3f (raw scanner units)'</span>,em.mean),<span class="string">'FontSize'</span>,16)
legend({<span class="string">'Probabilistic'</span>,<span class="string">'Deterministic'</span>})
<span class="keyword">end</span>
</pre><pre class="codeoutput">
ans =

     4     5     6     7     8     9

</pre><p class="footer"><br><a href="http://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2012b</a><br></p></div><!--
##### SOURCE BEGIN #####
function [fh, fe] = life_demo()
%% Example of initialization and fitting of the LiFE model
% This demo function illustrates how to:
%  - A - Set up a LiFE structure, identified as 'fe' (fascicle evaluation) in
%  the code below. This model contains a prediction of the diffusion
%  measurements in each white-matter voxel given by the fascicles contained
%  in a tractogrpahy solution, the connectome. Each fascicles makes a
%  prediction about the direction of diffusion in the set of voxels where
%  it travels through. The prediction is generated given the fascicle
%  orientation and position isndie the voxel. Predictions from multiple
%  fascicles in in each voxels are combined to generate a global connectome
%  prediciton for the diffusion signal in large sets of white matter
%  voxels.
%  - B - Fit the LiFE model to compute the weights associated to each fascicle
%  in the connectome. Fascicles in the conenctome contribute differently to
%  predicting the diffusion signal in each voxel. First of all, fascicles
%  make predictions about the diffusion only in voxels where they travel.
%  Secondly, some fascicles have paths that produce better diffusion
%  predictions than others. We use a least-square method to find the
%  contribution of each fascicle to the diffusion signal in the white
%  matter voxels where the fascicles travels. A single weight is assigned
%  to each fascicle representing the global contribution of the fasicle to
%  the signal of all the voxels along its path - we call this
%  fascicle-global. Because multiple fascicles exist in several voxels the
%  set of fascicles weights and fascicles predicitons represents the
%  connectome-global prediction of the diffusion signal within the entire
%  set of white matter voxels. Estimating the fascicle weights allows for
%  evaluating the quality of the tractography solution. Eliminating
%  fascicles that do not contribute to predicting the diffusion signal
%  (they have assigned a zreo-weight). Finaly, the root-mean-squared error
%  (RMSE) of the model to the diffusion data - the model prediction error -
%  is used to evaluate the model prediction quality, compare different
%  tractography models and to perform statistical inference on the on
%  properties of the connectomes.
%  - C - Compare two different connectome models. This demo will show how to
%  compare two different conenctome models by using the diffusion
%  prediction error (the Root-Mean-Squared Error, RMSE). We report the
%  example of two conenctomes one generated using Constrained-spherical
%  deconvolution (CSD) and probabilistic tractography the other using a
%  tensor model and deterministic tractography
%  - Note - The example connectomes used for this demo comprise a portion
%  of the right occiptial lobe of an individual human brain. LiFE utilizes
%  large-scale methods to solve the foward model. The software allows for
%  solving connectomes spanning the entire white-matter of idnvidual
%  brains. The size of the connectome on the test data set is small enought
%  to allow for testing the code within a few minutes requiring only about
%  10GB of computer RAM and standard hardaware. This code has been tested
%  with: 
%
%   - Ubuntu 12.04.4 LTS (Precise) 
%   - 2.6Ghz i7 Processor and 24GB of RAM.
%   - MatLab Version: 8.0.0.783 (R2012b)
%
%   - Mac OSX 10.9
%   - 1.8 Ghz i5 Processor and 8GB of RAM
%   - MatLab Version: 8.0.0.783 (R2012b)
%
% Copyright (2013-2014), Franco Pestilli, Stanford University, pestillifranco@gmail.com.

% Intialize a local matlab cluster if the parallel toolbox is available.
% This helps speeding up computations espacially for large conenctomes.
feOpenLocalCluster;

%% Build the file names for the diffusion data, the anatomical MRI.
dwiFile       = fullfile(lifeDemoDataPath('diffusion'),'life_demo_scan1_subject1_b2000_150dirs_stanford.nii.gz');
dwiFileRepeat = fullfile(lifeDemoDataPath('diffusion'),'life_demo_scan2_subject1_b2000_150dirs_stanford.nii.gz');
t1File        = fullfile(lifeDemoDataPath('anatomy'),  'life_demo_anatomy_t1w_stanford.nii.gz');

%% (1) Evaluate the Probabilistic CSD-based connectome.
% We will analyze first the CSD-based probabilistic tractography
% connectome.
prob.tractography = 'Probabilistic';
fgFileName    = fullfile(lifeDemoDataPath('tractography'), ...
                'life_demo_mrtrix_csd_lmax10_probabilistic.mat');

% The final connectome and data astructure will be saved with this name:
feFileName    = 'life_build_model_demo_CSD_PROB';

%% (1.1) Initialize the LiFE model structure, 'fe' in the code below. 
% This structure contains the forward model of diffusion based on the
% tractography solution. It also contains all the information necessary to
% compute model accuracry, and perform statistical tests. You can type
% help('feBuildModel') in the MatLab prompt for more information.
fe = feConnectomeInit(dwiFile,fgFileName,feFileName,[],dwiFileRepeat,t1File);

%% (1.2) Fit the model. 
% Hereafter we fit the forward model of tracrography using a least-squared
% method. The information generated by fitting the model (fiber weights
% etc) is then installed in the LiFE structure.
fe = feSet(fe,'fit',feFitModel(feGet(fe,'mfiber'),feGet(fe,'dsigdemeaned'),'bbnnls'));

%% (1.3) Extract the RMSE of the model on the fitted data set. 
% We now use the LiFE structure and the fit to compute the error in each
% white-matter voxel spanned by the tractography model.
prob.rmse   = feGet(fe,'vox rmse');

%% (1.4) Extract the RMSE of the model on the second data set. 
% Here we show how to compute the cross-valdiated RMSE of the tractography
% model in each white-matter voxel. We store this information for later use
% and to save computer memory.
prob.rmsexv = feGetRep(fe,'vox rmse');

%% (1.5) Extract the Rrmse. 
% We show how to extract the ratio between the model prediction error
% (RMSE) and the test-retest reliability of the data.
prob.rrmse  = feGetRep(fe,'vox rmse ratio');

%% (1.6) Extract the fitted weights for the fascicles. 
% The following line shows how to extract the weight assigned to each
% fascicle in the connectome.
prob.w      = feGet(fe,'fiber weights');

%% (1.7) Plot a histogram of the RMSE. 
% We plot the histogram of  RMSE across white-mater voxels.
[fh(1), ~, ~] = plotHistRMSE(prob);

%% (1.8) Plot a histogram of the RMSE ratio.
% As a reminder the Rrmse is the ratio between data test-retest reliability
% and model error (the quality of the model fit).
[fh(2), ~] = plotHistRrmse(prob);

%% (1.9) Plot a histogram of the fitted fascicle weights. 
[fh(3), ~] = plotHistWeights(prob);
fe = feConnectomeInit(dwiFile,fgFileName,feFileName,[],dwiFileRepeat,t1File);

%% Extract the coordinates of the white-matter voxels
% We will use this later to compare probabilistic and deterministic models.
p.coords = feGet(fe,'roi coords');
clear fe

%% (2) Evaluate the Deterministic tensor-based connectome.
% We will now analyze the tensor-based Deterministic tractography
% connectome.
det.tractography = 'Deterministic';
fgFileName    = fullfile(lifeDemoDataPath('tractography'), ...
                'life_demo_mrtrix_tensor_deterministic.mat');

% The final connectome and data astructure will be saved with this name:
feFileName    = 'life_build_model_demo_TENSOR_DET';

%% (2.1) Initialize the LiFE model structure, 'fe' in the code below. 
% This structure contains the forward model of diffusion based on the
% tractography solution. It also contains all the information necessary to
% compute model accuracry, and perform statistical tests. You can type
% help('feBuildModel') in the MatLab prompt for more information.
fe = feConnectomeInit(dwiFile,fgFileName,feFileName,[],dwiFileRepeat,t1File);

%% (2.2) Fit the model. 
% Hereafter we fit the forward model of tracrography using a least-squared
% method. The information generated by fitting the model (fiber weights
% etc) is then installed in the LiFE structure.
fe = feSet(fe,'fit',feFitModel(feGet(fe,'mfiber'),feGet(fe,'dsigdemeaned'),'bbnnls'));

%% (2.3) Extract the RMSE of the model on the fitted data set. 
% We now use the LiFE structure and the fit to compute the error in each
% white-matter voxel spanned by the tractography model.
det.rmse   = feGet(fe,'vox rmse');

%% (2.4) Extract the RMSE of the model on the second data set. 
% Here we show how to compute the cross-valdiated RMSE of the tractography
% model in each white-matter voxel. We store this information for later use
% and to save computer memory.
det.rmsexv = feGetRep(fe,'vox rmse');

%% (2.5) Extract the Rrmse. 
% We show how to extract the ratio between the model prediction error
% (RMSE) and the test-retest reliability of the data.
det.rrmse  = feGetRep(fe,'vox rmse ratio');

%% (2.6) Extract the fitted weights for the fascicles. 
% The following line shows how to extract the weight assigned to each
% fascicle in the connectome.
det.w      = feGet(fe,'fiber weights');

%% (2.7) Plot a histogram of the RMSE. 
% We plot the histogram of  RMSE across white-mater voxels.
[fh(1), ~, ~] = plotHistRMSE(det);

%% (2.8) Plot a histogram of the RMSE ratio.
% As a reminder the Rrmse is the ratio between data test-retest reliability
% and model error (the quality of the model fit).
[fh(2), ~] = plotHistRrmse(det);

%% (2.9) Plot a histogram of the fitted fascicle weights. 
[fh(3), ~] = plotHistWeights(det);

%% Extract the coordinates of the white-matter voxels.
% We will use this later to compare probabilistic and deterministic models.
d.coords = feGet( fe, 'roi coords');
clear fe

%% (3) Compare the quality of fit of Probabilistic and Deterministic connectomes.
%% (3.1) Find the common coordinates between the two connectomes.
%
% The two tractography method might have passed through slightly different
% white-matter voxels. Here we find the voxels where both models passed. We
% will compare the error only in these common voxels. There are more
% coordinates in the Prob connectome, because the tracking fills up more
% White-matter.
%
% So, hereafter:
% - First we find the indices in the probabilistic connectome of the
% coordinate in the deterministic connectome. But there are some of the
% coordinates in the Deterministic conectome that are NOT in the
% Probabilistic connectome.
%
% - Second we find the indices in the Deterministic connectome of the
% subset of coordinates in the Probabilistic connectome found in the
% previous step.
%
% - Third we find the common voxels. These allow us to find the rmse for
% the same voxels.
fprintf('Finding common brain coordinates between P and D connectomes...\n')
prob.coordsIdx = ismember(p.coords,d.coords,'rows');
prob.coords    = p.coords(prob.coordsIdx,:);
det.coordsIdx  = ismember(d.coords,prob.coords,'rows');
det.coords     = d.coords(det.coordsIdx,:);
prob.rmse      = prob.rmse( prob.coordsIdx);
det.rmse       = det.rmse( det.coordsIdx);
clear p d

%% (3.2) Make a scatter plot of the RMSE of the two tractography models
fh(4) = scatterPlotRMSE(det,prob);

%% (3.3) Compute the strength-of-evidence (S) and the Earth Movers Distance.
% Compare the RMSE of the two models using the Stregth-of-evidence and the
% Earth Movers Distance.
se = feComputeEvidence(prob.rmse,det.rmse);

%% (3.4) Strength of evidence in favor of Probabilistic tractography. 
% Plot the distributions of resampled mean RMSE
% used to compute the strength of evidence (S).
fh(5) = distributionPlotStrengthOfEvidence(se);

%% (3.5) RMSE distributions for Probabilistic and Deterministic tractography. 
% Compare the distributions using the Earth Movers Distance.
% Plot the distributions of RMSE for the two models and report the Earth
% Movers Distance between the distributions.
fh(6) = distributionPlotEarthMoversDistance(se);

end

% REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH Local Plot Functions REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH- %
function [fh, rmse, rmsexv] = plotHistRMSE(info)
% Make a plot of the RMSE:
rmse   = info.rmse;
rmsexv = info.rmsexv;

figName = sprintf('%s - RMSE',info.tractography);
fh = mrvNewGraphWin(figName);
[y,x] = hist(rmse,50);
plot(x,y,'k-');
hold on
[y,x] = hist(rmsexv,50);
plot(x,y,'r-');
set(gca,'tickdir','out','fontsize',16,'box','off');
title('Root-mean squared error distribution across voxels','fontsize',16);
ylabel('number of voxels','fontsize',16);
xlabel('rmse (scanner units)','fontsize',16);
legend({'RMSE fitted data set','RMSE cross-validated'},'fontsize',16);
end

function [fh, R] = plotHistRrmse(info)
% Make a plot of the RMSE Ratio:

R       = info.rrmse;
figName = sprintf('%s - RMSE RATIO',info.tractography);
fh      = mrvNewGraphWin(figName);
[y,x]   = hist(R,linspace(.5,4,50));
plot(x,y,'k-','linewidth',2);
hold on
plot([median(R) median(R)],[0 1200],'r-','linewidth',2);
plot([1 1],[0 1200],'k-');
set(gca,'tickdir','out','fontsize',16,'box','off');
title('Root-mean squared error ratio','fontsize',16);
ylabel('number of voxels','fontsize',16);
xlabel('R_{rmse}','fontsize',16);
legend({sprintf('Distribution of R_{rmse}'),sprintf('Median R_{rmse}')});
end

function [fh, w] = plotHistWeights(info)
% Make a plot of the weights:

w       = info.w;
figName = sprintf('%s - Distribution of fascicle weights',info.tractography);
fh      = mrvNewGraphWin(figName);
[y,x]   = hist(w( w > 0 ),logspace(-5,-.3,40));
semilogx(x,y,'k-','linewidth',2)
set(gca,'tickdir','out','fontsize',16,'box','off')
title( ...
    sprintf('Number of fascicles candidate connectome: %2.0f\nNumber of fascicles in optimized connetome: %2.0f' ...
    ,length(w),sum(w > 0)),'fontsize',16)
ylabel('Number of fascicles','fontsize',16)
xlabel('Fascicle weight','fontsize',16)
end

function fh = scatterPlotRMSE(det,prob)
figNameRmse = sprintf('prob_vs_det_rmse_common_voxels_map');
fh = mrvNewGraphWin(figNameRmse);
[ymap,x]  = hist3([det.rmse;prob.rmse]',{[10:1:70], [10:1:70]});
ymap = ymap./length(prob.rmse);
sh   = imagesc(flipud(log10(ymap)));
cm   = colormap(flipud(hot)); view(0,90);
axis('square')      
set(gca, ...
    'xlim',[1 length(x{1})],...
    'ylim',[1 length(x{1})], ...
    'ytick',[1 (length(x{1})/2) length(x{1})], ...
    'xtick',[1 (length(x{1})/2) length(x{1})], ...
    'yticklabel',[x{1}(end) x{1}(round(end/2)) x{1}(1)], ...
    'xticklabel',[x{1}(1)   x{1}(round(end/2)) x{1}(end)], ...
    'tickdir','out','ticklen',[.025 .05],'box','off', ...
    'fontsize',16,'visible','on')
hold on
plot3([1 length(x{1})],[length(x{1}) 1],[max(ymap(:)) max(ymap(:))],'k-','linewidth',1)
ylabel('Deterministic_{rmse}','fontsize',16)
xlabel('Probabilistic_{rmse}','fontsize',16)
cb = colorbar;
tck = get(cb,'ytick');
set(cb,'yTick',[min(tck)  mean(tck) max(tck)], ...
    'yTickLabel',round(1000*10.^[min(tck),...
    mean(tck), ...
    max(tck)])/1000, ...
    'tickdir','out','ticklen',[.025 .05],'box','on', ...
    'fontsize',16,'visible','on')
end

function fh = distributionPlotStrengthOfEvidence(se)

y_e        = se.s.unlesioned_e;
ywo_e      = se.s.lesioned_e;
dprime     = se.s.mean;
std_dprime = se.s.std;
xhis       = se.s.unlesioned.xbins;
woxhis     = se.s.lesioned.xbins;

histcolor{1} = [0 0 0];
histcolor{2} = [.95 .6 .5];
figName = sprintf('Strength_of_Evidence_test_PROB_vs_DET_model_rmse_mean_HIST');
fh = mrvNewGraphWin(figName);
patch([xhis,xhis],y_e(:),histcolor{1},'FaceColor',histcolor{1},'EdgeColor',histcolor{1});
hold on
patch([woxhis,woxhis],ywo_e(:),histcolor{2},'FaceColor',histcolor{2},'EdgeColor',histcolor{2}); 
set(gca,'tickdir','out', ...
        'box','off', ...
        'ticklen',[.025 .05], ...
        'ylim',[0 .2], ... 
        'xlim',[min(xhis) max(woxhis)], ...
        'xtick',[min(xhis) round(mean([xhis, woxhis])) max(woxhis)], ...
        'ytick',[0 .1 .2], ...
        'fontsize',16)
ylabel('Probability','fontsize',16)
xlabel('rmse','fontsize',16')

title(sprintf('Strength of evidence:\n mean %2.3f - std %2.3f',dprime,std_dprime), ...
    'FontSize',16)
legend({'Probabilistic','Deterministic'})
end

function fh = distributionPlotEarthMoversDistance(se)

prob = se.nolesion;
det  = se.lesion;
em   = se.em;

histcolor{1} = [0 0 0];
histcolor{2} = [.95 .6 .5];
figName = sprintf('EMD_PROB_DET_model_rmse_mean_HIST');
fh = mrvNewGraphWin(figName);
plot(prob.xhist,prob.hist,'r-','color',histcolor{1},'linewidth',4);
hold on
plot(det.xhist,det.hist,'r-','color',histcolor{2},'linewidth',4); 
set(gca,'tickdir','out', ...
        'box','off', ...
        'ticklen',[.025 .05], ...
        'ylim',[0 .12], ... 
        'xlim',[0 95], ...
        'xtick',[0 45 90], ...
        'ytick',[0 .06 .12], ...
        'fontsize',16)
ylabel('Proportion white-matter volume','fontsize',16)
xlabel('RMSE (raw MRI scanner units)','fontsize',16')
title(sprintf('Earth Movers Distance: %2.3f (raw scanner units)',em.mean),'FontSize',16)
legend({'Probabilistic','Deterministic'})
end


##### SOURCE END #####
--></body></html>
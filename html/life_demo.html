
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>life_demo</title><meta name="generator" content="MATLAB 8.0"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2014-07-16"><meta name="DC.source" content="life_demo.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img { margin-bottom:0px; } 

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, tt, code { font-size:12px; }
pre { margin:0px 0px 20px; }
pre.error { color:red; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><h2>Contents</h2><div><ul><li><a href="#2">Example of initialization and fitting of the LiFE model</a></li><li><a href="#3">Build the file names for the diffusion data, the anatomical MRI.</a></li><li><a href="#4">(1) Evaluate the Probabilistic CSD-based connectome.</a></li><li><a href="#5">(1.1) Initialize the LiFE model structure, 'fe' in the code below.</a></li><li><a href="#6">(1.2) Fit the model.</a></li><li><a href="#7">(1.3) Extract the RMSE of the model on the fitted data set.</a></li><li><a href="#8">(1.4) Extract the RMSE of the model on the second data set.</a></li><li><a href="#9">(1.5) Extract the Rrmse.</a></li><li><a href="#10">(1.6) Extract the fitted weights for the fascicles.</a></li><li><a href="#11">(1.7) Plot a histogram of the RMSE.</a></li><li><a href="#12">(1.8) Plot a histogram of the RMSE ratio.</a></li><li><a href="#13">(1.9) Plot a histogram of the fitted fascicle weights.</a></li><li><a href="#14">Extract the coordinates of the white-matter voxels</a></li><li><a href="#15">(2) Evaluate the Deterministic tensor-based connectome.</a></li><li><a href="#16">(2.1) Initialize the LiFE model structure, 'fe' in the code below.</a></li><li><a href="#17">(2.2) Fit the model.</a></li><li><a href="#18">(2.3) Extract the RMSE of the model on the fitted data set.</a></li><li><a href="#19">(2.4) Extract the RMSE of the model on the second data set.</a></li><li><a href="#20">(2.5) Extract the Rrmse.</a></li><li><a href="#21">(2.6) Extract the fitted weights for the fascicles.</a></li><li><a href="#22">(2.7) Plot a histogram of the RMSE.</a></li><li><a href="#23">(2.8) Plot a histogram of the RMSE ratio.</a></li><li><a href="#24">(2.9) Plot a histogram of the fitted fascicle weights.</a></li><li><a href="#25">Extract the coordinates of the white-matter voxels.</a></li><li><a href="#26">(3) Compare the quality of fit of Probabilistic and Deterministic connectomes.</a></li><li><a href="#27">(3.1) Find the common coordinates between the two connectomes.</a></li><li><a href="#28">(3.2) Make a scatter plot of the RMSE of the two tractography models</a></li><li><a href="#29">(3.3) Compute the strength-of-evidence (S) and the Earth Movers Distance.</a></li><li><a href="#30">(3.4) Strength of evidence in favor of Probabilistic tractography.</a></li><li><a href="#31">(3.5) RMSE distributions for Probabilistic and Deterministic tractography.</a></li></ul></div><pre class="codeinput"><span class="keyword">function</span> [fh, fe] = life_demo()
</pre><h2>Example of initialization and fitting of the LiFE model<a name="2"></a></h2><p>This demo function illustrates how to:  - A - Set up a LiFE structure, identified as 'fe' (fascicle evaluation) in  the code below. This model contains a prediction of the diffusion  measurements in each white-matter voxel given by the fascicles contained  in a tractogrpahy solution, the connectome. Each fascicles makes a  prediction about the direction of diffusion in the set of voxels where  it travels through. The prediction is generated given the fascicle  orientation and position isndie the voxel. Predictions from multiple  fascicles in in each voxels are combined to generate a global connectome  prediciton for the diffusion signal in large sets of white matter  voxels.  - B - Fit the LiFE model to compute the weights associated to each fascicle  in the connectome. Fascicles in the conenctome contribute differently to  predicting the diffusion signal in each voxel. First of all, fascicles  make predictions about the diffusion only in voxels where they travel.  Secondly, some fascicles have paths that produce better diffusion  predictions than others. We use a least-square method to find the  contribution of each fascicle to the diffusion signal in the white  matter voxels where the fascicles travels. A single weight is assigned  to each fascicle representing the global contribution of the fasicle to  the signal of all the voxels along its path - we call this  fascicle-global. Because multiple fascicles exist in several voxels the  set of fascicles weights and fascicles predicitons represents the  connectome-global prediction of the diffusion signal within the entire  set of white matter voxels. Estimating the fascicle weights allows for  evaluating the quality of the tractography solution. Eliminating  fascicles that do not contribute to predicting the diffusion signal  (they have assigned a zreo-weight). Finaly, the root-mean-squared error  (RMSE) of the model to the diffusion data - the model prediction error -  is used to evaluate the model prediction quality, compare different  tractography models and to perform statistical inference on the on  properties of the connectomes.  - C - Compare two different connectome models. This demo will show how to  compare two different conenctome models by using the diffusion  prediction error (the Root-Mean-Squared Error, RMSE). We report the  example of two conenctomes one generated using Constrained-spherical  deconvolution (CSD) and probabilistic tractography the other using a  tensor model and deterministic tractography  - Note - The example connectomes used for this demo comprise a portion  of the right occiptial lobe of an individual human brain. LiFE utilizes  large-scale methods to solve the foward model. The software allows for  solving connectomes spanning the entire white-matter of idnvidual  brains. The size of the connectome on the test data set is small enought  to allow for testing the code within a few minutes requiring only about  10GB of computer RAM and standard hardaware. This code has been tested  with:</p><pre class="language-matlab">- Ubuntu 12.04.4 LTS (Precise)
- 2.6Ghz i7 <span class="string">Processor</span> <span class="string">and</span> <span class="string">24GB</span> <span class="string">of</span> <span class="string">RAM.</span>
- MatLab Version: 8.0.0.783 (R2012b)
</pre><pre class="language-matlab">- Mac OSX <span class="string">10.9</span>
- 1.8 Ghz <span class="string">i5</span> <span class="string">Processor</span> <span class="string">and</span> <span class="string">8GB</span> <span class="string">of</span> <span class="string">RAM</span>
- MatLab Version: 8.0.0.783 (R2012b)
</pre><p>Copyright (2013-2014), Franco Pestilli, Stanford University, <a href="mailto:pestillifranco@gmail.com">pestillifranco@gmail.com</a>.</p><pre class="codeinput"><span class="comment">% Intialize a local matlab cluster if the parallel toolbox is available.</span>
<span class="comment">% This helps speeding up computations espacially for large conenctomes.</span>
feOpenLocalCluster;
</pre><pre class="codeoutput">Starting matlabpool using the 'local' profile ... connected to 12 workers.
</pre><h2>Build the file names for the diffusion data, the anatomical MRI.<a name="3"></a></h2><pre class="codeinput">dwiFile       = fullfile(lifeDemoDataPath(<span class="string">'diffusion'</span>),<span class="string">'life_demo_scan1_subject1_b2000_150dirs_stanford.nii.gz'</span>);
dwiFileRepeat = fullfile(lifeDemoDataPath(<span class="string">'diffusion'</span>),<span class="string">'life_demo_scan2_subject1_b2000_150dirs_stanford.nii.gz'</span>);
t1File        = fullfile(lifeDemoDataPath(<span class="string">'anatomy'</span>),  <span class="string">'life_demo_anatomy_t1w_stanford.nii.gz'</span>);
</pre><pre class="codeoutput">Undefined function 'lifeDemoDataPath' for input arguments of type 'char'.

Error in life_demo (line 65)
dwiFile       = fullfile(lifeDemoDataPath('diffusion'),'life_demo_scan1_subject1_b2000_150dirs_stanford.nii.gz');
</pre><h2>(1) Evaluate the Probabilistic CSD-based connectome.<a name="4"></a></h2><p>We will analyze first the CSD-based probabilistic tractography connectome.</p><pre class="codeinput">prob.tractography = <span class="string">'Probabilistic'</span>;
fgFileName    = fullfile(lifeDemoDataPath(<span class="string">'tractography'</span>), <span class="keyword">...</span>
                <span class="string">'life_demo_mrtrix_csd_lmax10_probabilistic.mat'</span>);

<span class="comment">% The final connectome and data astructure will be saved with this name:</span>
feFileName    = <span class="string">'life_build_model_demo_CSD_PROB'</span>;
</pre><h2>(1.1) Initialize the LiFE model structure, 'fe' in the code below.<a name="5"></a></h2><p>This structure contains the forward model of diffusion based on the tractography solution. It also contains all the information necessary to compute model accuracry, and perform statistical tests. You can type help('feBuildModel') in the MatLab prompt for more information.</p><pre class="codeinput">fe = feConnectomeInit(dwiFile,fgFileName,feFileName,[],dwiFileRepeat,t1File);
</pre><h2>(1.2) Fit the model.<a name="6"></a></h2><p>Hereafter we fit the forward model of tracrography using a least-squared method. The information generated by fitting the model (fiber weights etc) is then installed in the LiFE structure.</p><pre class="codeinput">fe = feSet(fe,<span class="string">'fit'</span>,feFitModel(feGet(fe,<span class="string">'mfiber'</span>),feGet(fe,<span class="string">'dsigdemeaned'</span>),<span class="string">'bbnnls'</span>));
</pre><h2>(1.3) Extract the RMSE of the model on the fitted data set.<a name="7"></a></h2><p>We now use the LiFE structure and the fit to compute the error in each white-matter voxel spanned by the tractography model.</p><pre class="codeinput">prob.rmse   = feGet(fe,<span class="string">'vox rmse'</span>);
</pre><h2>(1.4) Extract the RMSE of the model on the second data set.<a name="8"></a></h2><p>Here we show how to compute the cross-valdiated RMSE of the tractography model in each white-matter voxel. We store this information for later use and to save computer memory.</p><pre class="codeinput">prob.rmsexv = feGetRep(fe,<span class="string">'vox rmse'</span>);
</pre><h2>(1.5) Extract the Rrmse.<a name="9"></a></h2><p>We show how to extract the ratio between the model prediction error (RMSE) and the test-retest reliability of the data.</p><pre class="codeinput">prob.rrmse  = feGetRep(fe,<span class="string">'vox rmse ratio'</span>);
</pre><h2>(1.6) Extract the fitted weights for the fascicles.<a name="10"></a></h2><p>The following line shows how to extract the weight assigned to each fascicle in the connectome.</p><pre class="codeinput">prob.w      = feGet(fe,<span class="string">'fiber weights'</span>);
</pre><h2>(1.7) Plot a histogram of the RMSE.<a name="11"></a></h2><p>We plot the histogram of  RMSE across white-mater voxels.</p><pre class="codeinput">[fh(1), ~, ~] = plotHistRMSE(prob);
</pre><h2>(1.8) Plot a histogram of the RMSE ratio.<a name="12"></a></h2><p>As a reminder the Rrmse is the ratio between data test-retest reliability and model error (the quality of the model fit).</p><pre class="codeinput">[fh(2), ~] = plotHistRrmse(prob);
</pre><h2>(1.9) Plot a histogram of the fitted fascicle weights.<a name="13"></a></h2><pre class="codeinput">[fh(3), ~] = plotHistWeights(prob);
fe = feConnectomeInit(dwiFile,fgFileName,feFileName,[],dwiFileRepeat,t1File);
</pre><h2>Extract the coordinates of the white-matter voxels<a name="14"></a></h2><p>We will use this later to compare probabilistic and deterministic models.</p><pre class="codeinput">p.coords = feGet(fe,<span class="string">'roi coords'</span>);
clear <span class="string">fe</span>
</pre><h2>(2) Evaluate the Deterministic tensor-based connectome.<a name="15"></a></h2><p>We will now analyze the tensor-based Deterministic tractography connectome.</p><pre class="codeinput">det.tractography = <span class="string">'Deterministic'</span>;
fgFileName    = fullfile(lifeDemoDataPath(<span class="string">'tractography'</span>), <span class="keyword">...</span>
                <span class="string">'life_demo_mrtrix_tensor_deterministic.mat'</span>);

<span class="comment">% The final connectome and data astructure will be saved with this name:</span>
feFileName    = <span class="string">'life_build_model_demo_TENSOR_DET'</span>;
</pre><h2>(2.1) Initialize the LiFE model structure, 'fe' in the code below.<a name="16"></a></h2><p>This structure contains the forward model of diffusion based on the tractography solution. It also contains all the information necessary to compute model accuracry, and perform statistical tests. You can type help('feBuildModel') in the MatLab prompt for more information.</p><pre class="codeinput">fe = feConnectomeInit(dwiFile,fgFileName,feFileName,[],dwiFileRepeat,t1File);
</pre><h2>(2.2) Fit the model.<a name="17"></a></h2><p>Hereafter we fit the forward model of tracrography using a least-squared method. The information generated by fitting the model (fiber weights etc) is then installed in the LiFE structure.</p><pre class="codeinput">fe = feSet(fe,<span class="string">'fit'</span>,feFitModel(feGet(fe,<span class="string">'mfiber'</span>),feGet(fe,<span class="string">'dsigdemeaned'</span>),<span class="string">'bbnnls'</span>));
</pre><h2>(2.3) Extract the RMSE of the model on the fitted data set.<a name="18"></a></h2><p>We now use the LiFE structure and the fit to compute the error in each white-matter voxel spanned by the tractography model.</p><pre class="codeinput">det.rmse   = feGet(fe,<span class="string">'vox rmse'</span>);
</pre><h2>(2.4) Extract the RMSE of the model on the second data set.<a name="19"></a></h2><p>Here we show how to compute the cross-valdiated RMSE of the tractography model in each white-matter voxel. We store this information for later use and to save computer memory.</p><pre class="codeinput">det.rmsexv = feGetRep(fe,<span class="string">'vox rmse'</span>);
</pre><h2>(2.5) Extract the Rrmse.<a name="20"></a></h2><p>We show how to extract the ratio between the model prediction error (RMSE) and the test-retest reliability of the data.</p><pre class="codeinput">det.rrmse  = feGetRep(fe,<span class="string">'vox rmse ratio'</span>);
</pre><h2>(2.6) Extract the fitted weights for the fascicles.<a name="21"></a></h2><p>The following line shows how to extract the weight assigned to each fascicle in the connectome.</p><pre class="codeinput">det.w      = feGet(fe,<span class="string">'fiber weights'</span>);
</pre><h2>(2.7) Plot a histogram of the RMSE.<a name="22"></a></h2><p>We plot the histogram of  RMSE across white-mater voxels.</p><pre class="codeinput">[fh(1), ~, ~] = plotHistRMSE(det);
</pre><h2>(2.8) Plot a histogram of the RMSE ratio.<a name="23"></a></h2><p>As a reminder the Rrmse is the ratio between data test-retest reliability and model error (the quality of the model fit).</p><pre class="codeinput">[fh(2), ~] = plotHistRrmse(det);
</pre><h2>(2.9) Plot a histogram of the fitted fascicle weights.<a name="24"></a></h2><pre class="codeinput">[fh(3), ~] = plotHistWeights(det);
</pre><h2>Extract the coordinates of the white-matter voxels.<a name="25"></a></h2><p>We will use this later to compare probabilistic and deterministic models.</p><pre class="codeinput">d.coords = feGet( fe, <span class="string">'roi coords'</span>);
clear <span class="string">fe</span>
</pre><h2>(3) Compare the quality of fit of Probabilistic and Deterministic connectomes.<a name="26"></a></h2><h2>(3.1) Find the common coordinates between the two connectomes.<a name="27"></a></h2><p>The two tractography method might have passed through slightly different white-matter voxels. Here we find the voxels where both models passed. We will compare the error only in these common voxels. There are more coordinates in the Prob connectome, because the tracking fills up more White-matter.</p><p>So, hereafter: - First we find the indices in the probabilistic connectome of the coordinate in the deterministic connectome. But there are some of the coordinates in the Deterministic conectome that are NOT in the Probabilistic connectome.</p><p>- Second we find the indices in the Deterministic connectome of the subset of coordinates in the Probabilistic connectome found in the previous step.</p><p>- Third we find the common voxels. These allow us to find the rmse for the same voxels.</p><pre class="codeinput">fprintf(<span class="string">'Finding common brain coordinates between P and D connectomes...\n'</span>)
prob.coordsIdx = ismember(p.coords,d.coords,<span class="string">'rows'</span>);
prob.coords    = p.coords(prob.coordsIdx,:);
det.coordsIdx  = ismember(d.coords,prob.coords,<span class="string">'rows'</span>);
det.coords     = d.coords(det.coordsIdx,:);
prob.rmse      = prob.rmse( prob.coordsIdx);
det.rmse       = det.rmse( det.coordsIdx);
clear <span class="string">p</span> <span class="string">d</span>
</pre><h2>(3.2) Make a scatter plot of the RMSE of the two tractography models<a name="28"></a></h2><pre class="codeinput">fh(4) = scatterPlotRMSE(det,prob);
</pre><h2>(3.3) Compute the strength-of-evidence (S) and the Earth Movers Distance.<a name="29"></a></h2><p>Compare the RMSE of the two models using the Stregth-of-evidence and the Earth Movers Distance.</p><pre class="codeinput">se = feComputeEvidence(prob.rmse,det.rmse);
</pre><h2>(3.4) Strength of evidence in favor of Probabilistic tractography.<a name="30"></a></h2><p>Plot the distributions of resampled mean RMSE used to compute the strength of evidence (S).</p><pre class="codeinput">fh(5) = distributionPlotStrengthOfEvidence(se);
</pre><h2>(3.5) RMSE distributions for Probabilistic and Deterministic tractography.<a name="31"></a></h2><p>Compare the distributions using the Earth Movers Distance. Plot the distributions of RMSE for the two models and report the Earth Movers Distance between the distributions.</p><pre class="codeinput">fh(6) = distributionPlotEarthMoversDistance(se);
</pre><pre class="codeinput"><span class="keyword">end</span>

<span class="comment">% ---------- Local Plot Functions ----------- %</span>
<span class="keyword">function</span> [fh, rmse, rmsexv] = plotHistRMSE(info)
<span class="comment">% Make a plot of the RMSE:</span>
rmse   = info.rmse;
rmsexv = info.rmsexv;

figName = sprintf(<span class="string">'%s - RMSE'</span>,info.tractography);
fh = mrvNewGraphWin(figName);
[y,x] = hist(rmse,50);
plot(x,y,<span class="string">'k-'</span>);
hold <span class="string">on</span>
[y,x] = hist(rmsexv,50);
plot(x,y,<span class="string">'r-'</span>);
set(gca,<span class="string">'tickdir'</span>,<span class="string">'out'</span>,<span class="string">'fontsize'</span>,16,<span class="string">'box'</span>,<span class="string">'off'</span>);
title(<span class="string">'Root-mean squared error distribution across voxels'</span>,<span class="string">'fontsize'</span>,16);
ylabel(<span class="string">'number of voxels'</span>,<span class="string">'fontsize'</span>,16);
xlabel(<span class="string">'rmse (scanner units)'</span>,<span class="string">'fontsize'</span>,16);
legend({<span class="string">'RMSE fitted data set'</span>,<span class="string">'RMSE cross-validated'</span>},<span class="string">'fontsize'</span>,16);
<span class="keyword">end</span>

<span class="keyword">function</span> [fh, R] = plotHistRrmse(info)
<span class="comment">% Make a plot of the RMSE Ratio:</span>

R       = info.rrmse;
figName = sprintf(<span class="string">'%s - RMSE RATIO'</span>,info.tractography);
fh      = mrvNewGraphWin(figName);
[y,x]   = hist(R,linspace(.5,4,50));
plot(x,y,<span class="string">'k-'</span>,<span class="string">'linewidth'</span>,2);
hold <span class="string">on</span>
plot([median(R) median(R)],[0 1200],<span class="string">'r-'</span>,<span class="string">'linewidth'</span>,2);
plot([1 1],[0 1200],<span class="string">'k-'</span>);
set(gca,<span class="string">'tickdir'</span>,<span class="string">'out'</span>,<span class="string">'fontsize'</span>,16,<span class="string">'box'</span>,<span class="string">'off'</span>);
title(<span class="string">'Root-mean squared error ratio'</span>,<span class="string">'fontsize'</span>,16);
ylabel(<span class="string">'number of voxels'</span>,<span class="string">'fontsize'</span>,16);
xlabel(<span class="string">'R_{rmse}'</span>,<span class="string">'fontsize'</span>,16);
legend({sprintf(<span class="string">'Distribution of R_{rmse}'</span>),sprintf(<span class="string">'Median R_{rmse}'</span>)});
<span class="keyword">end</span>

<span class="keyword">function</span> [fh, w] = plotHistWeights(info)
<span class="comment">% Make a plot of the weights:</span>

w       = info.w;
figName = sprintf(<span class="string">'%s - Distribution of fascicle weights'</span>,info.tractography);
fh      = mrvNewGraphWin(figName);
[y,x]   = hist(w( w &gt; 0 ),logspace(-5,-.3,40));
semilogx(x,y,<span class="string">'k-'</span>,<span class="string">'linewidth'</span>,2)
set(gca,<span class="string">'tickdir'</span>,<span class="string">'out'</span>,<span class="string">'fontsize'</span>,16,<span class="string">'box'</span>,<span class="string">'off'</span>)
title( <span class="keyword">...</span>
    sprintf(<span class="string">'Number of fascicles candidate connectome: %2.0f\nNumber of fascicles in optimized connetome: %2.0f'</span> <span class="keyword">...</span>
    ,length(w),sum(w &gt; 0)),<span class="string">'fontsize'</span>,16)
ylabel(<span class="string">'Number of fascicles'</span>,<span class="string">'fontsize'</span>,16)
xlabel(<span class="string">'Fascicle weight'</span>,<span class="string">'fontsize'</span>,16)
<span class="keyword">end</span>

<span class="keyword">function</span> fh = scatterPlotRMSE(det,prob)
figNameRmse = sprintf(<span class="string">'prob_vs_det_rmse_common_voxels_map'</span>);
fh = mrvNewGraphWin(figNameRmse);
[ymap,x]  = hist3([det.rmse;prob.rmse]',{[10:1:70], [10:1:70]});
ymap = ymap./length(prob.rmse);
sh   = imagesc(flipud(log10(ymap)));
cm   = colormap(flipud(hot)); view(0,90);
axis(<span class="string">'square'</span>)
set(gca, <span class="keyword">...</span>
    <span class="string">'xlim'</span>,[1 length(x{1})],<span class="keyword">...</span>
    <span class="string">'ylim'</span>,[1 length(x{1})], <span class="keyword">...</span>
    <span class="string">'ytick'</span>,[1 (length(x{1})/2) length(x{1})], <span class="keyword">...</span>
    <span class="string">'xtick'</span>,[1 (length(x{1})/2) length(x{1})], <span class="keyword">...</span>
    <span class="string">'yticklabel'</span>,[x{1}(end) x{1}(round(end/2)) x{1}(1)], <span class="keyword">...</span>
    <span class="string">'xticklabel'</span>,[x{1}(1)   x{1}(round(end/2)) x{1}(end)], <span class="keyword">...</span>
    <span class="string">'tickdir'</span>,<span class="string">'out'</span>,<span class="string">'ticklen'</span>,[.025 .05],<span class="string">'box'</span>,<span class="string">'off'</span>, <span class="keyword">...</span>
    <span class="string">'fontsize'</span>,16,<span class="string">'visible'</span>,<span class="string">'on'</span>)
hold <span class="string">on</span>
plot3([1 length(x{1})],[length(x{1}) 1],[max(ymap(:)) max(ymap(:))],<span class="string">'k-'</span>,<span class="string">'linewidth'</span>,1)
ylabel(<span class="string">'Deterministic_{rmse}'</span>,<span class="string">'fontsize'</span>,16)
xlabel(<span class="string">'Probabilistic_{rmse}'</span>,<span class="string">'fontsize'</span>,16)
cb = colorbar;
tck = get(cb,<span class="string">'ytick'</span>);
set(cb,<span class="string">'yTick'</span>,[min(tck)  mean(tck) max(tck)], <span class="keyword">...</span>
    <span class="string">'yTickLabel'</span>,round(1000*10.^[min(tck),<span class="keyword">...</span>
    mean(tck), <span class="keyword">...</span>
    max(tck)])/1000, <span class="keyword">...</span>
    <span class="string">'tickdir'</span>,<span class="string">'out'</span>,<span class="string">'ticklen'</span>,[.025 .05],<span class="string">'box'</span>,<span class="string">'on'</span>, <span class="keyword">...</span>
    <span class="string">'fontsize'</span>,16,<span class="string">'visible'</span>,<span class="string">'on'</span>)
<span class="keyword">end</span>

<span class="keyword">function</span> fh = distributionPlotStrengthOfEvidence(se)

y_e        = se.s.unlesioned_e;
ywo_e      = se.s.lesioned_e;
dprime     = se.s.mean;
std_dprime = se.s.std;
xhis       = se.s.unlesioned.xbins;
woxhis     = se.s.lesioned.xbins;

histcolor{1} = [0 0 0];
histcolor{2} = [.95 .6 .5];
figName = sprintf(<span class="string">'Strength_of_Evidence_test_PROB_vs_DET_model_rmse_mean_HIST'</span>);
fh = mrvNewGraphWin(figName);
patch([xhis,xhis],y_e(:),histcolor{1},<span class="string">'FaceColor'</span>,histcolor{1},<span class="string">'EdgeColor'</span>,histcolor{1});
hold <span class="string">on</span>
patch([woxhis,woxhis],ywo_e(:),histcolor{2},<span class="string">'FaceColor'</span>,histcolor{2},<span class="string">'EdgeColor'</span>,histcolor{2});
set(gca,<span class="string">'tickdir'</span>,<span class="string">'out'</span>, <span class="keyword">...</span>
        <span class="string">'box'</span>,<span class="string">'off'</span>, <span class="keyword">...</span>
        <span class="string">'ticklen'</span>,[.025 .05], <span class="keyword">...</span>
        <span class="string">'ylim'</span>,[0 .2], <span class="keyword">...</span>
        <span class="string">'xlim'</span>,[min(xhis) max(woxhis)], <span class="keyword">...</span>
        <span class="string">'xtick'</span>,[min(xhis) round(mean([xhis, woxhis])) max(woxhis)], <span class="keyword">...</span>
        <span class="string">'ytick'</span>,[0 .1 .2], <span class="keyword">...</span>
        <span class="string">'fontsize'</span>,16)
ylabel(<span class="string">'Probability'</span>,<span class="string">'fontsize'</span>,16)
xlabel(<span class="string">'rmse'</span>,<span class="string">'fontsize'</span>,16')

title(sprintf(<span class="string">'Strength of evidence:\n mean %2.3f - std %2.3f'</span>,dprime,std_dprime), <span class="keyword">...</span>
    <span class="string">'FontSize'</span>,16)
legend({<span class="string">'Probabilistic'</span>,<span class="string">'Deterministic'</span>})
<span class="keyword">end</span>

<span class="keyword">function</span> fh = distributionPlotEarthMoversDistance(se)

prob = se.nolesion;
det  = se.lesion;
em   = se.em;

histcolor{1} = [0 0 0];
histcolor{2} = [.95 .6 .5];
figName = sprintf(<span class="string">'EMD_PROB_DET_model_rmse_mean_HIST'</span>);
fh = mrvNewGraphWin(figName);
plot(prob.xhist,prob.hist,<span class="string">'r-'</span>,<span class="string">'color'</span>,histcolor{1},<span class="string">'linewidth'</span>,4);
hold <span class="string">on</span>
plot(det.xhist,det.hist,<span class="string">'r-'</span>,<span class="string">'color'</span>,histcolor{2},<span class="string">'linewidth'</span>,4);
set(gca,<span class="string">'tickdir'</span>,<span class="string">'out'</span>, <span class="keyword">...</span>
        <span class="string">'box'</span>,<span class="string">'off'</span>, <span class="keyword">...</span>
        <span class="string">'ticklen'</span>,[.025 .05], <span class="keyword">...</span>
        <span class="string">'ylim'</span>,[0 .12], <span class="keyword">...</span>
        <span class="string">'xlim'</span>,[0 95], <span class="keyword">...</span>
        <span class="string">'xtick'</span>,[0 45 90], <span class="keyword">...</span>
        <span class="string">'ytick'</span>,[0 .06 .12], <span class="keyword">...</span>
        <span class="string">'fontsize'</span>,16)
ylabel(<span class="string">'Proportion white-matter volume'</span>,<span class="string">'fontsize'</span>,16)
xlabel(<span class="string">'RMSE (raw MRI scanner units)'</span>,<span class="string">'fontsize'</span>,16')
title(sprintf(<span class="string">'Earth Movers Distance: %2.3f (raw scanner units)'</span>,em.mean),<span class="string">'FontSize'</span>,16)
legend({<span class="string">'Probabilistic'</span>,<span class="string">'Deterministic'</span>})
<span class="keyword">end</span>
</pre><p class="footer"><br><a href="http://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2012b</a><br></p></div><!--
##### SOURCE BEGIN #####
function [fh, fe] = life_demo()
%% Example of initialization and fitting of the LiFE model
% This demo function illustrates how to:
%  - A - Set up a LiFE structure, identified as 'fe' (fascicle evaluation) in
%  the code below. This model contains a prediction of the diffusion
%  measurements in each white-matter voxel given by the fascicles contained
%  in a tractogrpahy solution, the connectome. Each fascicles makes a
%  prediction about the direction of diffusion in the set of voxels where
%  it travels through. The prediction is generated given the fascicle
%  orientation and position isndie the voxel. Predictions from multiple
%  fascicles in in each voxels are combined to generate a global connectome
%  prediciton for the diffusion signal in large sets of white matter
%  voxels.
%  - B - Fit the LiFE model to compute the weights associated to each fascicle
%  in the connectome. Fascicles in the conenctome contribute differently to
%  predicting the diffusion signal in each voxel. First of all, fascicles
%  make predictions about the diffusion only in voxels where they travel.
%  Secondly, some fascicles have paths that produce better diffusion
%  predictions than others. We use a least-square method to find the
%  contribution of each fascicle to the diffusion signal in the white
%  matter voxels where the fascicles travels. A single weight is assigned
%  to each fascicle representing the global contribution of the fasicle to
%  the signal of all the voxels along its path - we call this
%  fascicle-global. Because multiple fascicles exist in several voxels the
%  set of fascicles weights and fascicles predicitons represents the
%  connectome-global prediction of the diffusion signal within the entire
%  set of white matter voxels. Estimating the fascicle weights allows for
%  evaluating the quality of the tractography solution. Eliminating
%  fascicles that do not contribute to predicting the diffusion signal
%  (they have assigned a zreo-weight). Finaly, the root-mean-squared error
%  (RMSE) of the model to the diffusion data - the model prediction error -
%  is used to evaluate the model prediction quality, compare different
%  tractography models and to perform statistical inference on the on
%  properties of the connectomes.
%  - C - Compare two different connectome models. This demo will show how to
%  compare two different conenctome models by using the diffusion
%  prediction error (the Root-Mean-Squared Error, RMSE). We report the
%  example of two conenctomes one generated using Constrained-spherical
%  deconvolution (CSD) and probabilistic tractography the other using a
%  tensor model and deterministic tractography
%  - Note - The example connectomes used for this demo comprise a portion
%  of the right occiptial lobe of an individual human brain. LiFE utilizes
%  large-scale methods to solve the foward model. The software allows for
%  solving connectomes spanning the entire white-matter of idnvidual
%  brains. The size of the connectome on the test data set is small enought
%  to allow for testing the code within a few minutes requiring only about
%  10GB of computer RAM and standard hardaware. This code has been tested
%  with: 
%
%   - Ubuntu 12.04.4 LTS (Precise) 
%   - 2.6Ghz i7 Processor and 24GB of RAM.
%   - MatLab Version: 8.0.0.783 (R2012b)
%
%   - Mac OSX 10.9
%   - 1.8 Ghz i5 Processor and 8GB of RAM
%   - MatLab Version: 8.0.0.783 (R2012b)
%
% Copyright (2013-2014), Franco Pestilli, Stanford University, pestillifranco@gmail.com.

% Intialize a local matlab cluster if the parallel toolbox is available.
% This helps speeding up computations espacially for large conenctomes.
feOpenLocalCluster;

%% Build the file names for the diffusion data, the anatomical MRI.
dwiFile       = fullfile(lifeDemoDataPath('diffusion'),'life_demo_scan1_subject1_b2000_150dirs_stanford.nii.gz');
dwiFileRepeat = fullfile(lifeDemoDataPath('diffusion'),'life_demo_scan2_subject1_b2000_150dirs_stanford.nii.gz');
t1File        = fullfile(lifeDemoDataPath('anatomy'),  'life_demo_anatomy_t1w_stanford.nii.gz');

%% (1) Evaluate the Probabilistic CSD-based connectome.
% We will analyze first the CSD-based probabilistic tractography
% connectome.
prob.tractography = 'Probabilistic';
fgFileName    = fullfile(lifeDemoDataPath('tractography'), ...
                'life_demo_mrtrix_csd_lmax10_probabilistic.mat');

% The final connectome and data astructure will be saved with this name:
feFileName    = 'life_build_model_demo_CSD_PROB';

%% (1.1) Initialize the LiFE model structure, 'fe' in the code below. 
% This structure contains the forward model of diffusion based on the
% tractography solution. It also contains all the information necessary to
% compute model accuracry, and perform statistical tests. You can type
% help('feBuildModel') in the MatLab prompt for more information.
fe = feConnectomeInit(dwiFile,fgFileName,feFileName,[],dwiFileRepeat,t1File);

%% (1.2) Fit the model. 
% Hereafter we fit the forward model of tracrography using a least-squared
% method. The information generated by fitting the model (fiber weights
% etc) is then installed in the LiFE structure.
fe = feSet(fe,'fit',feFitModel(feGet(fe,'mfiber'),feGet(fe,'dsigdemeaned'),'bbnnls'));

%% (1.3) Extract the RMSE of the model on the fitted data set. 
% We now use the LiFE structure and the fit to compute the error in each
% white-matter voxel spanned by the tractography model.
prob.rmse   = feGet(fe,'vox rmse');

%% (1.4) Extract the RMSE of the model on the second data set. 
% Here we show how to compute the cross-valdiated RMSE of the tractography
% model in each white-matter voxel. We store this information for later use
% and to save computer memory.
prob.rmsexv = feGetRep(fe,'vox rmse');

%% (1.5) Extract the Rrmse. 
% We show how to extract the ratio between the model prediction error
% (RMSE) and the test-retest reliability of the data.
prob.rrmse  = feGetRep(fe,'vox rmse ratio');

%% (1.6) Extract the fitted weights for the fascicles. 
% The following line shows how to extract the weight assigned to each
% fascicle in the connectome.
prob.w      = feGet(fe,'fiber weights');

%% (1.7) Plot a histogram of the RMSE. 
% We plot the histogram of  RMSE across white-mater voxels.
[fh(1), ~, ~] = plotHistRMSE(prob);

%% (1.8) Plot a histogram of the RMSE ratio.
% As a reminder the Rrmse is the ratio between data test-retest reliability
% and model error (the quality of the model fit).
[fh(2), ~] = plotHistRrmse(prob);

%% (1.9) Plot a histogram of the fitted fascicle weights. 
[fh(3), ~] = plotHistWeights(prob);
fe = feConnectomeInit(dwiFile,fgFileName,feFileName,[],dwiFileRepeat,t1File);

%% Extract the coordinates of the white-matter voxels
% We will use this later to compare probabilistic and deterministic models.
p.coords = feGet(fe,'roi coords');
clear fe

%% (2) Evaluate the Deterministic tensor-based connectome.
% We will now analyze the tensor-based Deterministic tractography
% connectome.
det.tractography = 'Deterministic';
fgFileName    = fullfile(lifeDemoDataPath('tractography'), ...
                'life_demo_mrtrix_tensor_deterministic.mat');

% The final connectome and data astructure will be saved with this name:
feFileName    = 'life_build_model_demo_TENSOR_DET';

%% (2.1) Initialize the LiFE model structure, 'fe' in the code below. 
% This structure contains the forward model of diffusion based on the
% tractography solution. It also contains all the information necessary to
% compute model accuracry, and perform statistical tests. You can type
% help('feBuildModel') in the MatLab prompt for more information.
fe = feConnectomeInit(dwiFile,fgFileName,feFileName,[],dwiFileRepeat,t1File);

%% (2.2) Fit the model. 
% Hereafter we fit the forward model of tracrography using a least-squared
% method. The information generated by fitting the model (fiber weights
% etc) is then installed in the LiFE structure.
fe = feSet(fe,'fit',feFitModel(feGet(fe,'mfiber'),feGet(fe,'dsigdemeaned'),'bbnnls'));

%% (2.3) Extract the RMSE of the model on the fitted data set. 
% We now use the LiFE structure and the fit to compute the error in each
% white-matter voxel spanned by the tractography model.
det.rmse   = feGet(fe,'vox rmse');

%% (2.4) Extract the RMSE of the model on the second data set. 
% Here we show how to compute the cross-valdiated RMSE of the tractography
% model in each white-matter voxel. We store this information for later use
% and to save computer memory.
det.rmsexv = feGetRep(fe,'vox rmse');

%% (2.5) Extract the Rrmse. 
% We show how to extract the ratio between the model prediction error
% (RMSE) and the test-retest reliability of the data.
det.rrmse  = feGetRep(fe,'vox rmse ratio');

%% (2.6) Extract the fitted weights for the fascicles. 
% The following line shows how to extract the weight assigned to each
% fascicle in the connectome.
det.w      = feGet(fe,'fiber weights');

%% (2.7) Plot a histogram of the RMSE. 
% We plot the histogram of  RMSE across white-mater voxels.
[fh(1), ~, ~] = plotHistRMSE(det);

%% (2.8) Plot a histogram of the RMSE ratio.
% As a reminder the Rrmse is the ratio between data test-retest reliability
% and model error (the quality of the model fit).
[fh(2), ~] = plotHistRrmse(det);

%% (2.9) Plot a histogram of the fitted fascicle weights. 
[fh(3), ~] = plotHistWeights(det);

%% Extract the coordinates of the white-matter voxels.
% We will use this later to compare probabilistic and deterministic models.
d.coords = feGet( fe, 'roi coords');
clear fe

%% (3) Compare the quality of fit of Probabilistic and Deterministic connectomes.
%% (3.1) Find the common coordinates between the two connectomes.
%
% The two tractography method might have passed through slightly different
% white-matter voxels. Here we find the voxels where both models passed. We
% will compare the error only in these common voxels. There are more
% coordinates in the Prob connectome, because the tracking fills up more
% White-matter.
%
% So, hereafter:
% - First we find the indices in the probabilistic connectome of the
% coordinate in the deterministic connectome. But there are some of the
% coordinates in the Deterministic conectome that are NOT in the
% Probabilistic connectome.
%
% - Second we find the indices in the Deterministic connectome of the
% subset of coordinates in the Probabilistic connectome found in the
% previous step.
%
% - Third we find the common voxels. These allow us to find the rmse for
% the same voxels.
fprintf('Finding common brain coordinates between P and D connectomes...\n')
prob.coordsIdx = ismember(p.coords,d.coords,'rows');
prob.coords    = p.coords(prob.coordsIdx,:);
det.coordsIdx  = ismember(d.coords,prob.coords,'rows');
det.coords     = d.coords(det.coordsIdx,:);
prob.rmse      = prob.rmse( prob.coordsIdx);
det.rmse       = det.rmse( det.coordsIdx);
clear p d

%% (3.2) Make a scatter plot of the RMSE of the two tractography models
fh(4) = scatterPlotRMSE(det,prob);

%% (3.3) Compute the strength-of-evidence (S) and the Earth Movers Distance.
% Compare the RMSE of the two models using the Stregth-of-evidence and the
% Earth Movers Distance.
se = feComputeEvidence(prob.rmse,det.rmse);

%% (3.4) Strength of evidence in favor of Probabilistic tractography. 
% Plot the distributions of resampled mean RMSE
% used to compute the strength of evidence (S).
fh(5) = distributionPlotStrengthOfEvidence(se);

%% (3.5) RMSE distributions for Probabilistic and Deterministic tractography. 
% Compare the distributions using the Earth Movers Distance.
% Plot the distributions of RMSE for the two models and report the Earth
% Movers Distance between the distributions.
fh(6) = distributionPlotEarthMoversDistance(se);

end

% REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH Local Plot Functions REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH- %
function [fh, rmse, rmsexv] = plotHistRMSE(info)
% Make a plot of the RMSE:
rmse   = info.rmse;
rmsexv = info.rmsexv;

figName = sprintf('%s - RMSE',info.tractography);
fh = mrvNewGraphWin(figName);
[y,x] = hist(rmse,50);
plot(x,y,'k-');
hold on
[y,x] = hist(rmsexv,50);
plot(x,y,'r-');
set(gca,'tickdir','out','fontsize',16,'box','off');
title('Root-mean squared error distribution across voxels','fontsize',16);
ylabel('number of voxels','fontsize',16);
xlabel('rmse (scanner units)','fontsize',16);
legend({'RMSE fitted data set','RMSE cross-validated'},'fontsize',16);
end

function [fh, R] = plotHistRrmse(info)
% Make a plot of the RMSE Ratio:

R       = info.rrmse;
figName = sprintf('%s - RMSE RATIO',info.tractography);
fh      = mrvNewGraphWin(figName);
[y,x]   = hist(R,linspace(.5,4,50));
plot(x,y,'k-','linewidth',2);
hold on
plot([median(R) median(R)],[0 1200],'r-','linewidth',2);
plot([1 1],[0 1200],'k-');
set(gca,'tickdir','out','fontsize',16,'box','off');
title('Root-mean squared error ratio','fontsize',16);
ylabel('number of voxels','fontsize',16);
xlabel('R_{rmse}','fontsize',16);
legend({sprintf('Distribution of R_{rmse}'),sprintf('Median R_{rmse}')});
end

function [fh, w] = plotHistWeights(info)
% Make a plot of the weights:

w       = info.w;
figName = sprintf('%s - Distribution of fascicle weights',info.tractography);
fh      = mrvNewGraphWin(figName);
[y,x]   = hist(w( w > 0 ),logspace(-5,-.3,40));
semilogx(x,y,'k-','linewidth',2)
set(gca,'tickdir','out','fontsize',16,'box','off')
title( ...
    sprintf('Number of fascicles candidate connectome: %2.0f\nNumber of fascicles in optimized connetome: %2.0f' ...
    ,length(w),sum(w > 0)),'fontsize',16)
ylabel('Number of fascicles','fontsize',16)
xlabel('Fascicle weight','fontsize',16)
end

function fh = scatterPlotRMSE(det,prob)
figNameRmse = sprintf('prob_vs_det_rmse_common_voxels_map');
fh = mrvNewGraphWin(figNameRmse);
[ymap,x]  = hist3([det.rmse;prob.rmse]',{[10:1:70], [10:1:70]});
ymap = ymap./length(prob.rmse);
sh   = imagesc(flipud(log10(ymap)));
cm   = colormap(flipud(hot)); view(0,90);
axis('square')      
set(gca, ...
    'xlim',[1 length(x{1})],...
    'ylim',[1 length(x{1})], ...
    'ytick',[1 (length(x{1})/2) length(x{1})], ...
    'xtick',[1 (length(x{1})/2) length(x{1})], ...
    'yticklabel',[x{1}(end) x{1}(round(end/2)) x{1}(1)], ...
    'xticklabel',[x{1}(1)   x{1}(round(end/2)) x{1}(end)], ...
    'tickdir','out','ticklen',[.025 .05],'box','off', ...
    'fontsize',16,'visible','on')
hold on
plot3([1 length(x{1})],[length(x{1}) 1],[max(ymap(:)) max(ymap(:))],'k-','linewidth',1)
ylabel('Deterministic_{rmse}','fontsize',16)
xlabel('Probabilistic_{rmse}','fontsize',16)
cb = colorbar;
tck = get(cb,'ytick');
set(cb,'yTick',[min(tck)  mean(tck) max(tck)], ...
    'yTickLabel',round(1000*10.^[min(tck),...
    mean(tck), ...
    max(tck)])/1000, ...
    'tickdir','out','ticklen',[.025 .05],'box','on', ...
    'fontsize',16,'visible','on')
end

function fh = distributionPlotStrengthOfEvidence(se)

y_e        = se.s.unlesioned_e;
ywo_e      = se.s.lesioned_e;
dprime     = se.s.mean;
std_dprime = se.s.std;
xhis       = se.s.unlesioned.xbins;
woxhis     = se.s.lesioned.xbins;

histcolor{1} = [0 0 0];
histcolor{2} = [.95 .6 .5];
figName = sprintf('Strength_of_Evidence_test_PROB_vs_DET_model_rmse_mean_HIST');
fh = mrvNewGraphWin(figName);
patch([xhis,xhis],y_e(:),histcolor{1},'FaceColor',histcolor{1},'EdgeColor',histcolor{1});
hold on
patch([woxhis,woxhis],ywo_e(:),histcolor{2},'FaceColor',histcolor{2},'EdgeColor',histcolor{2}); 
set(gca,'tickdir','out', ...
        'box','off', ...
        'ticklen',[.025 .05], ...
        'ylim',[0 .2], ... 
        'xlim',[min(xhis) max(woxhis)], ...
        'xtick',[min(xhis) round(mean([xhis, woxhis])) max(woxhis)], ...
        'ytick',[0 .1 .2], ...
        'fontsize',16)
ylabel('Probability','fontsize',16)
xlabel('rmse','fontsize',16')

title(sprintf('Strength of evidence:\n mean %2.3f - std %2.3f',dprime,std_dprime), ...
    'FontSize',16)
legend({'Probabilistic','Deterministic'})
end

function fh = distributionPlotEarthMoversDistance(se)

prob = se.nolesion;
det  = se.lesion;
em   = se.em;

histcolor{1} = [0 0 0];
histcolor{2} = [.95 .6 .5];
figName = sprintf('EMD_PROB_DET_model_rmse_mean_HIST');
fh = mrvNewGraphWin(figName);
plot(prob.xhist,prob.hist,'r-','color',histcolor{1},'linewidth',4);
hold on
plot(det.xhist,det.hist,'r-','color',histcolor{2},'linewidth',4); 
set(gca,'tickdir','out', ...
        'box','off', ...
        'ticklen',[.025 .05], ...
        'ylim',[0 .12], ... 
        'xlim',[0 95], ...
        'xtick',[0 45 90], ...
        'ytick',[0 .06 .12], ...
        'fontsize',16)
ylabel('Proportion white-matter volume','fontsize',16)
xlabel('RMSE (raw MRI scanner units)','fontsize',16')
title(sprintf('Earth Movers Distance: %2.3f (raw scanner units)',em.mean),'FontSize',16)
legend({'Probabilistic','Deterministic'})
end


##### SOURCE END #####
--></body></html>